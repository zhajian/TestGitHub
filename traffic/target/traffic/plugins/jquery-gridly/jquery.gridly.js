(function(){var e,d,a,c,b=function(g,h){return function(){return g.apply(h,arguments)}},f=[].slice;e=jQuery;d=(function(){function g(){}g.transitions={webkitTransition:"webkitTransitionEnd",mozTransition:"mozTransitionEnd",oTransition:"oTransitionEnd",transition:"transitionend"};g.transition=function(i){var k,h,j,l;k=i[0];l=this.transitions;for(j in l){h=l[j];if(k.style[j]!=null){return h}}};g.execute=function(h,j){var i;i=this.transition(h);if(i!=null){return h.one(i,j)}else{return j()}};return g})();a=(function(){function g(j,h,i){this.click=b(this.click,this);this.moved=b(this.moved,this);this.ended=b(this.ended,this);this.began=b(this.began,this);this.coordinate=b(this.coordinate,this);this.off=b(this.off,this);this.on=b(this.on,this);this.toggle=b(this.toggle,this);this.bind=b(this.bind,this);this.$container=j;this.selector=h;this.callbacks=i;this.toggle()}g.prototype.bind=function(h){if(h==null){h="on"}e(document)[h]("mousemove touchmove",this.moved);return e(document)[h]("mouseup touchend touchcancel",this.ended)};g.prototype.toggle=function(h){if(h==null){h="on"}this.$container[h]("mousedown touchstart",this.selector,this.began);return this.$container[h]("click",this.selector,this.click)};g.prototype.on=function(){return this.toggle("on")};g.prototype.off=function(){return this.toggle("off")};g.prototype.coordinate=function(h){switch(h.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return h.originalEvent.touches[0];default:return h}};g.prototype.began=function(h){var i;if(this.$target){return}h.preventDefault();h.stopPropagation();this.bind("on");this.$target=e(h.target).closest(this.$container.find(this.selector));this.$target.addClass("dragging");this.origin={x:this.coordinate(h).pageX-this.$target.position().left,y:this.coordinate(h).pageY-this.$target.position().top};return(i=this.callbacks)!=null?typeof i.began==="function"?i.began(h):void 0:void 0};g.prototype.ended=function(h){var i;if(this.$target==null){return}h.preventDefault();h.stopPropagation();this.bind("off");this.$target.removeClass("dragging");delete this.$target;delete this.origin;return(i=this.callbacks)!=null?typeof i.ended==="function"?i.ended(h):void 0:void 0};g.prototype.moved=function(h){var i;if(this.$target==null){return}h.preventDefault();h.stopPropagation();this.$target.css({left:this.coordinate(h).pageX-this.origin.x,top:this.coordinate(h).pageY-this.origin.y});this.dragged=this.$target;return(i=this.callbacks)!=null?typeof i.moved==="function"?i.moved(h):void 0:void 0};g.prototype.click=function(h){if(!this.dragged){return}h.preventDefault();h.stopPropagation();return delete this.dragged};return g})();c=(function(){g.settings={base:60,gutter:20,columns:12,draggable:{zIndex:800,selector:"> *"}};g.gridly=function(i,h){var j;if(h==null){h={}}j=i.data("_gridly");if(!j){j=new g(i,h);i.data("_gridly",j)}return j};function g(h,i){if(i==null){i={}}this.optimize=b(this.optimize,this);this.layout=b(this.layout,this);this.structure=b(this.structure,this);this.position=b(this.position,this);this.size=b(this.size,this);this.draggingMoved=b(this.draggingMoved,this);this.draggingEnded=b(this.draggingEnded,this);this.draggingBegan=b(this.draggingBegan,this);this.$sorted=b(this.$sorted,this);this.draggable=b(this.draggable,this);this.compare=b(this.compare,this);this.$=b(this.$,this);this.reordinalize=b(this.reordinalize,this);this.ordinalize=b(this.ordinalize,this);this.$el=h;this.settings=e.extend({},g.settings,i);this.ordinalize(this.$("> *"));if(this.settings.draggable!==false){this.draggable()}return this}g.prototype.ordinalize=function(l){var j,k,n,m,h;h=[];for(k=n=0,m=l.length;0<=m?n<=m:n>=m;k=0<=m?++n:--n){j=e(l[k]);h.push(j.data("position",k))}return h};g.prototype.reordinalize=function(i,h){return i.data("position",h)};g.prototype.$=function(h){return this.$el.find(h)};g.prototype.compare=function(i,h){if(i.y>h.y+h.h){return +1}if(h.y>i.y+i.h){return -1}if((i.x+(i.w/2))>(h.x+(h.w/2))){return +1}if((h.x+(h.w/2))>(i.x+(i.w/2))){return -1}return 0};g.prototype.draggable=function(h){if(this._draggable==null){this._draggable=new a(this.$el,this.settings.draggable.selector,{began:this.draggingBegan,ended:this.draggingEnded,moved:this.draggingMoved})}if(h!=null){return this._draggable[h]()}};g.prototype.$sorted=function(h){return(h||this.$("> *")).sort(function(k,j){var n,m,i,o,p,l;n=e(k);m=e(j);i=n.data("position");p=m.data("position");o=parseInt(i);l=parseInt(p);if((i!=null)&&(p==null)){return -1}if((p!=null)&&(i==null)){return +1}if(!i&&!p&&n.index()<m.index()){return -1}if(!p&&!i&&m.index()<n.index()){return +1}if(o<l){return -1}if(l<o){return +1}return 0})};g.prototype.draggingBegan=function(j){var i,k,h;i=this.$sorted();this.ordinalize(i);setTimeout(this.layout,0);return(k=this.settings)!=null?(h=k.callbacks)!=null?typeof h.reordering==="function"?h.reordering(i):void 0:void 0:void 0};g.prototype.draggingEnded=function(j){var i,k,h;i=this.$sorted();this.ordinalize(i);setTimeout(this.layout,0);return(k=this.settings)!=null?(h=k.callbacks)!=null?typeof h.reordered==="function"?h.reordered(i):void 0:void 0:void 0};g.prototype.draggingMoved=function(h){var s,u,p,q,t,j,r,n,m,v,o,l,k;s=e(h.target).closest(this.$(this.settings.draggable.selector));u=this.$sorted(this.$(this.settings.draggable.selector));r=this.structure(u).positions;j=t=s.data("position");o=r.filter(function(i){return i.$element.is(s)});for(n=0,v=o.length;n<v;n++){p=o[n];p.x=s.position().left;p.y=s.position().top;p.w=s.data("width")||s.width();p.h=s.data("height")||s.height()}r.sort(this.compare);u=r.map(function(i){return i.$element});u=(((l=this.settings.callbacks)!=null?l.optimize:void 0)||this.optimize)(u);for(q=m=0,k=u.length;0<=k?m<k:m>k;q=0<=k?++m:--m){this.reordinalize(e(u[q]),q)}return this.layout()};g.prototype.size=function(h){return((h.data("width")||h.width())+this.settings.gutter)/(this.settings.base+this.settings.gutter)};g.prototype.position=function(q,j){var h,r,o,p,s,m,l,n,k;s=this.size(q);r=Infinity;h=0;for(o=m=0,n=j.length-s;0<=n?m<n:m>n;o=0<=n?++m:--m){p=Math.max.apply(Math,j.slice(o,o+s));if(p<r){r=p;h=o}}for(o=l=h,k=h+s;h<=k?l<k:l>k;o=h<=k?++l:--l){j[o]=r+(q.data("height")||q.height())+this.settings.gutter}return{x:h*(this.settings.base+this.settings.gutter),y:r}};g.prototype.structure=function(p){var q,h,l,o,n,m,j,k;if(p==null){p=this.$sorted()}m=[];h=(function(){var s,r,i;i=[];for(l=s=0,r=this.settings.columns;0<=r?s<=r:s>=r;l=0<=r?++s:--s){i.push(0)}return i}).call(this);for(o=j=0,k=p.length;0<=k?j<k:j>k;o=0<=k?++j:--j){q=e(p[o]);n=this.position(q,h);m.push({x:n.x,y:n.y,w:q.data("width")||q.width(),h:q.data("height")||q.height(),$element:q})}return{height:Math.max.apply(Math,h),positions:m}};g.prototype.layout=function(){var k,m,l,i,j,o,n,h;m=(((n=this.settings.callbacks)!=null?n.optimize:void 0)||this.optimize)(this.$sorted());j=this.structure(m);for(l=o=0,h=m.length;0<=h?o<h:o>h;l=0<=h?++o:--o){k=e(m[l]);i=j.positions[l];if(k.is(".dragging")){continue}k.css({position:"absolute",left:i.x,top:i.y})}return this.$el.css({height:j.height})};g.prototype.optimize=function(h){var k,i,j,m,l;j=[];k=0;while(h.length>0){if(k===this.settings.columns){k=0}i=0;for(i=m=0,l=h.length;0<=l?m<l:m>l;i=0<=l?++m:--m){if(k+this.size(e(h[i]))<=this.settings.columns){break}}if(i===h.length){i=0;k=0}k+=this.size(e(h[i]));j.push(h.splice(i,1)[0])}return j};return g})();e.fn.extend({gridly:function(){var g,h;g=arguments[0],h=2<=arguments.length?f.call(arguments,1):[];if(g==null){g={}}return this.each(function(){var k,j,i;k=e(this);i=e.extend({},e.fn.gridly.defaults,typeof g==="object"&&g);j=typeof g==="string"?g:g.action;if(j==null){j="layout"}return c.gridly(k,i)[j](h)})}})}).call(this);