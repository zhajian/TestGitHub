jQuery(function(f){var a="#grid-table";var b="#grid-pager";jQuery(a).jqGrid({url:G_CTX_PATH+"/smsAccount/list",datatype:"json",mtype:"GET",width:"300",height:"320",colNames:["id","租户名称","短信数量","有效期","状态"],colModel:[{name:"merchantId",index:"merchantId",width:25,sortable:false,hidden:true},{name:"merchantName",index:"merchantName",width:25,sortable:false},{name:"smsTotal",index:"smsTotal",width:25,sortable:false},{name:"effecDateStr",index:"effecDateStr",width:25,sortable:false},{name:"statusStr",index:"statusStr",width:25,sortable:false}],jsonReader:{root:"rows",total:function(i){var h=i.total;var j=parseInt(f("#grid-table").getGridParam("rowNum"));return h%j>0?h/j+1:h/j},page:"page",records:"total",repeatitems:false,subgrid:{repeatitems:false}},postData:{},viewrecords:true,rowNum:10,rowList:[10,20,30],pager:b,altRows:true,multiboxonly:true,loadComplete:function(){var h=this;setTimeout(function(){updatePagerIcons(h)},0)},autowidth:true,subGrid:true,subGridRowExpanded:g});function e(){f("#grid-table").jqGrid("setGridParam",{page:1});f("#grid-table").jqGrid("setGridParam",{postData:{merchantId:f("#onOff").val()},datatype:"json"}).trigger("reloadGrid")}f("#equipmentSearchBtn").on("click",function(){e()});function d(){f("#grid-table").jqGrid("setGridParam",{page:1});f("#grid-table").jqGrid("setGridParam",{postData:{},datatype:"json"}).trigger("reloadGrid")}f("#createBtn").on("click",function(){f("input[name=smsTotal]").removeAttr("readonly");f("#div_hidden").attr("hidden",true);f("#merchant").removeAttr("disabled");f("#data_form")[0].reset();Hg.refRepeatSubmit("data_form");f("#24healthModal").modal()});f("#updateBtn").on("click",function(){f("#div_hidden").removeAttr("hidden");f("input[name=smsTotal]").attr("readonly",true);f("#data_form")[0].reset();var i=f("#grid-table").jqGrid("getGridParam","selrow");if(i==null){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请选择行");return}Hg.refRepeatSubmit("data_form");var h=jQuery("#grid-table").jqGrid("getRowData",i);f("#merchant").attr("disabled","true");f("input[name=flag]").val(h.merchantId);Hg.post("/smsAccount/getByMerchantId",{id:h.merchantId},function(j){c(j.data)});f("#24healthModal").modal()});f("#addBtn").on("click",function(){Hg.refRepeatSubmit("data_add_form");f("input[name=smsTotal").removeAttr("readonly");f("#data_add_form")[0].reset();var i=f("#grid-table").jqGrid("getGridParam","selrow");if(i==null){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请选择行");return}var h=jQuery("#grid-table").jqGrid("getRowData",i);f("#merchant_id").val(h.merchantId);f("#add").modal()});f("#save").on("click",function(){var h=f("input[name=flag]").val();var l=f("#data_form").serializeArray();var i="/smsAccount/insert";if(h!=""){i="/smsAccount/update";l.push({name:"merchantId",value:h})}var k=f("#merchant").val();if(k==-1){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请选择租户");return}var j=f("input[name=smsTotal]").val();if(j==""){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请输入短信条数");return}Hg.post(i,l,function(m){if(m.success){ui_alert("保存成功！",function(){d()})}else{Hg.refreshSubmitToken("data_form");ui_error(m.data)}f("#24healthModal").modal("hide")})});f("#msg_save").on("click",function(){var h=f("#add_smsTotal").val();if(h==""){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请输入短信条数");return}Hg.post("/smsAccount/add",f("#data_add_form").serializeArray(),function(i){if(i.success){ui_alert("保存成功！",function(){d()})}else{Hg.refreshSubmitToken("data_add_form");ui_error(i.data)}f("#add").modal("hide")})});function c(k){f("select[name=merchantId").val(k.merchantId);f("input[name=smsTotal").val(k.smsTotal);f("input[name=effecDate").val(k.effecDateStr);f("select[name=status]").val(k.status);var j=k.list;for(var h=0;h<j.length;h++){switch(j[h].smsType){case 2:f("#select_pay").val(j[h].status);break;case 3:f("#select_give").val(j[h].status);break;case 4:f("#select_convert").val(j[h].status);break;case 5:f("#select_insert").val(j[h].status);break;default:f("#select_consume").val(j[h].status);break}}}Hg.post("/merchant/all",{},function(k){var l="";var j=k.rows;for(var h=0;h<j.length;h++){l+='<option value="'+j[h].merchantId+'">'+j[h].merchantName+"</option>"}f("#onOff").append(l);f("#merchant").append(l)});function g(l,j){var k='<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';var i="</table>";var h="";Hg.post("/smsSetting/list",{id:j},function(n){var n=n.rows;for(var m=0;m<n.length;m++){h+="<tr><td>"+n[m].smsTypeStr+"</td><td>"+n[m].statusStr+"</td></tr>"}f("#"+l).append(k+h+i)})}});