jQuery(function(d){var a="#grid-table";var b="#grid-pager";jQuery(a).jqGrid({url:G_CTX_PATH+"/sys/auth/list",datatype:"json",mtype:"GET",width:"300",height:"320",colNames:["权限编号","权限名称","权限类型","url","图标","层级","排序ID","不可修改","父模块","描述"],colModel:[{name:"authId",index:"authId",width:8,sortable:false,hidden:true},{name:"authName",index:"authName",width:6,sortable:false},{name:"authTypeStr",index:"authTypeStr",width:6,sortable:false,hidden:true},{name:"authUri",index:"authUri",width:20,sortable:false},{name:"authIcon",index:"authIcon",width:5,sortable:false,hidden:true},{name:"levelId",index:"levelId",width:8,sortable:false,hidden:true},{name:"orderId",index:"orderId",width:12,sortable:false,hidden:true},{name:"isFinalStr",index:"isFinalStr",width:5,sortable:false},{name:"fName",index:"fName",width:6,sortable:false},{name:"descr",index:"descr",width:20,sortable:false}],jsonReader:{root:"rows",total:function(f){var e=f.total;var g=parseInt(d("#grid-table").getGridParam("rowNum"));return e%g>0?e/g+1:e/g},page:"page",records:"total",repeatitems:false},postData:{},viewrecords:true,rowNum:10,rowList:[10,20,30],pager:b,altRows:true,multiboxonly:true,loadComplete:function(){var e=this;setTimeout(function(){updatePagerIcons(e)},0)},autowidth:true});function c(){d("#grid-table").jqGrid("setGridParam",{page:1});d("#grid-table").jqGrid("setGridParam",{postData:{authName:d("#authName").val(),},datatype:"json"}).trigger("reloadGrid")}d("#manageauthSearchBtn").on("click",function(){c()});d.post(G_CTX_PATH+"/manage/role/authList",function(e){d("#checkedAuthIds").append("<option value=''>----请选择父节点----</option>");d(e).each(function(){var f=d("<option value='"+this.authId+"'>"+this.authName+"</option>");d("#checkedAuthIds").append(f)})});d("#addSysAuthBtn").on("click",function(){d("#addAuthForm")[0].reset();d("#addAuthModal").modal();Hg.refRepeatSubmit("addAuthForm")});d.validator.addMethod("verifyName",function(g,e){var f=/^[a-zA-Z\u4e00-\u9fa5]{2,20}$/;return this.optional(e)||f.test(g)},"输入2~20位英文或中文姓名！");d.validator.addMethod("isMobile",function(g,e){var f=/^1\w{10}$/;return this.optional(e)||f.test(g)},"手机号格式不正确！");d.validator.addMethod("isPassword",function(g,e){var f=/[A-Za-z0-9]{6,10}/;return this.optional(e)||f.test(g)},"请输入6-10位字母、数字组成的字符串！");d.validator.addMethod("zhengshu",function(g,e){var f=/^[1-9]{1}[0-9]{0,9}/;return this.optional(e)||f.test(g)},"请输入大于1的整数");d("#addAuthForm").validate({rules:{authName:{required:true,verifyName:true},orderId:{required:true,zhengshu:true}}});d("#addAuthForm [tag=save]").click(function(){if(!d("#addAuthForm").validate().form()){return false}if(d("#checkedAuthIds").val()==""){alert("请选择父节点");return false}var f=d(this);f.addClass("disabled").removeClass("btn-primary");var e=d("#addAuthForm").serializeArray();d.ajax({type:"POST",url:G_CTX_PATH+"/sys/auth/add",data:e,success:function(g,i,h){if(g.success){ui_alert("保存成功",function(){d("#addAuthModal").modal("hide");c()})}else{ajaxExceptionHandler(h,function(){Hg.refreshSubmitToken("addAuthForm");ui_error(g.data)})}},complete:function(g,h){f.addClass("btn-primary").removeClass("disabled")}})});d("#deleteSysAuthBtn").on("click",function(){var f=jQuery("#grid-table").jqGrid("getGridParam","selrow");if(f){var e=jQuery("#grid-table").jqGrid("getRowData",f);d("#deleteAuthName").html("确认删除权限【"+e.authName+"】吗？");d("#deleteAuthId").val(e.authId);d("#deleteAuthModal").modal();Hg.refRepeatSubmit("deleteAuthForm")}else{alert("请选择要删除的行")}});d("#deleteAuthForm [tag=delete]").click(function(){var f=d(this);f.addClass("disabled").removeClass("btn-primary");var e=d("#deleteAuthForm").serializeArray();d.ajax({type:"POST",url:G_CTX_PATH+"/sys/auth/delete",data:e,success:function(g,i,h){if(g.success){ui_alert("删除成功",function(){d("#deleteAuthModal").modal("hide");c()})}else{ajaxExceptionHandler(h,function(){Hg.refreshSubmitToken("deleteAuthForm");ui_error(g.data);c()})}},complete:function(g,h){f.addClass("btn-primary").removeClass("disabled")}})});d("#updateSysAuthBtn").on("click",function(){var g=jQuery("#grid-table").jqGrid("getGridParam","selrow");if(g){var e=jQuery("#grid-table").jqGrid("getRowData",g);if(e.authId){var f={authId:e.authId};d.ajax({type:"POST",url:G_CTX_PATH+"/sys/auth/list",data:f,success:function(h,j,i){if(h.success){d("#updateAuthModal").modal();Hg.refRepeatSubmit("updateAuthForm");d("#newauthId").val(h.rows[0].authId);d("#newfid").val(h.rows[0].fid);d("#fatherName").val(h.rows[0].fName);d("#newauthName").val(h.rows[0].authName);d("#neworderId").val(h.rows[0].orderId);d("#newauthIcon").val(h.rows[0].authIcon);d("#newauthUri").val(h.rows[0].authUri);d("#newdescr").val(h.rows[0].descr)}else{ajaxExceptionHandler(i,function(){Hg.refreshSubmitToken("updateAuthForm");ui_error(h.data);c()})}},complete:function(h,i){}})}}else{alert("请选择要修改的行")}});d("#updateAuthForm").validate({rules:{authName:{required:true,verifyName:true},orderId:{required:true,zhengshu:true}}});d("#updateAuthForm [tag=update]").click(function(){if(!d("#updateAuthForm").validate().form()){return false}var f=d(this);f.addClass("disabled").removeClass("btn-primary");var e=d("#updateAuthForm").serializeArray();d.ajax({type:"POST",url:G_CTX_PATH+"/sys/auth/edit",data:e,success:function(g,i,h){if(g.success){ui_alert("修改成功",function(){d("#updateAuthModal").modal("hide");c()})}else{ajaxExceptionHandler(h,function(){Hg.refreshSubmitToken("updateAuthForm");ui_error(g.data)})}},complete:function(g,h){f.addClass("btn-primary").removeClass("disabled")}})})});