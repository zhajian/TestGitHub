jQuery(function(d){var f="#grid-table";var j="#grid-pager";jQuery(f).jqGrid({url:G_CTX_PATH+"/equipment/list",datatype:"json",mtype:"GET",width:"300",height:"320",colNames:["设备ID","设备SN","Mac地址","网关ID","设备信息","SSID","在线人数","开启状态"],colModel:[{name:"id",index:"id",width:8,sortable:false},{name:"serialNumber",index:"serialNumber",width:15,sortable:false},{name:"mac",index:"mac",width:15,sortable:false},{name:"gwId",index:"gwId",width:18,sortable:false},{name:"name",index:"name",width:20,sortable:false},{name:"ssid",index:"ssid",width:18,sortable:false},{name:"countUserOnline",index:"countUserOnline",width:10,sortable:false},{name:"lastHeartbeatTimeStr",index:"lastHeartbeatTimeStr",width:12,sortable:false}],jsonReader:{root:"rows",total:function(l){var k=l.total;var m=parseInt(d("#grid-table").getGridParam("rowNum"));return k%m>0?k/m+1:k/m},page:"page",records:"total",repeatitems:false},postData:{merchantId:d("#merchantId").val()},viewrecords:true,rowNum:10,rowList:[10,20,30],pager:j,altRows:true,multiboxonly:true,loadComplete:function(){var k=this;setTimeout(function(){updatePagerIcons(k)},0)},autowidth:true});function h(){d("#grid-table").jqGrid("setGridParam",{page:1});d("#grid-table").jqGrid("setGridParam",{postData:{serialNumber:d("#sn").val(),mac:d("#mac").val(),ssid:d("#ssid").val(),name:d("#name").val(),onOff:d("#onOff").val()},datatype:"json"}).trigger("reloadGrid")}click_tree_menu(function(k){d("#merchantId").val(k.attr("node"));h()});d("#equipmentSearchBtn").on("click",function(){h()});d("#healthBtn").on("click",function(){var k=[];var m;var l=d("#grid-table").jqGrid("getGridParam","selrow");if(l==null){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请选择行");return}d.getJSON(G_CTX_PATH+"/equipment/get24healthData/"+l,{},function(n){if(n.success){obj=n.basic;obj_health=n.data;var p=d("#grid-table").jqGrid("getGridParam","selrow");var o=jQuery("#grid-table").jqGrid("getRowData",p);d("#b_merchantName").text(obj.merchantName);d("#b_sn").text(obj.serialNumber);d("#b_mac").text(obj.mac);d("#b_gwId").text(obj.gwId);d("#b_name").text(obj.name);d("#b_ssid").text(obj.ssid);d("#b_lastHeartTime").text(obj.lastHeartbeatTimeStr);d("#b_onOff").text(o.lastHeartbeatTimeStr);d.each(obj_health,function(){var q=this.pingNum;k.push(q)});d("#container").highcharts({title:{text:"路由器工作频率走势",x:-20},xAxis:{title:{text:obj.pingTime+"日整点时间"},categories:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23"]},yAxis:{floor:0,ceiling:60,plotBands:[{color:"#90EE90",from:(0,30),to:(0,60)}],allowDecimals:false,title:{text:"频率"},plotLines:[{value:10,width:1,color:"#808080"}]},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:[{name:"路由器工作频率",data:k}]})}});d("#24healthModal").modal()});var g=function(p){var m=new Date();m.setDate(m.getDate()+p);var n=m.getFullYear();var o=m.getMonth()+1;var l=m.getDate();o=(o<10?"0"+o:o);l=(l<10?"0"+l:l);var k=n.toString()+"-"+o.toString()+"-"+l.toString();return k};var a="#conCountGrid-table";var b="#conCountGrid-pager";d("#conCountBtn").on("click",function(){var k=d("#grid-table").jqGrid("getGridParam","selrow");if(k==null){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请选择行");return}d("#conCountStart").val(g(-1).substring(0,8)+"01");d("#conCountEnd").val(g(-1));e(k);jQuery(a).jqGrid({url:G_CTX_PATH+"/equipment/conCount",datatype:"json",mtype:"GET",height:"320",colNames:["日期","上网人次","上网用户数"],colModel:[{name:"dateTime",index:"dateTime",sortable:false,key:true},{name:"yesterdayNum",index:"yesterdayNum",sortable:false},{name:"countUserNum",index:"yesterdayUserNum",sortable:false}],jsonReader:{root:"rows",total:function(m){var l=m.total;var n=parseInt(d("#conCountGrid-table").getGridParam("rowNum"));return l%n>0?l/n+1:l/n},page:"page",records:"total",repeatitems:false},postData:{id:k,conCountStartTime:d("#conCountStart").val(),conCountEndTime:d("#conCountEnd").val()},viewrecords:true,rowNum:10,rowList:[10,20,30],pager:b,altRows:true,multiboxonly:true,loadComplete:function(){var l=this;setTimeout(function(){updatePagerIcons(l)},0)},autowidth:false,ondblClickRow:function(l){d("[name='startTimee']").val(l);d("[name='endTimee']").val(l);document.formx1.submit()}});i();d("#conCountModal").modal()});d(window).resize(i);function i(){var k=c();d("#conCountGrid-table").jqGrid("setGridWidth",k.WinW-350)}function c(){var k,l;if(window.innerHeight){k=window.innerWidth;l=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){k=document.documentElement.clientWidth;l=document.documentElement.clientHeight}else{if(document.body){k=document.body.clientWidth;l=document.body.clientHeight}}}return{WinW:k,WinH:l}}d("#conCountSearchBtn").on("click",function(){var k=d("#grid-table").jqGrid("getGridParam","selrow");if(k==null){ui_error("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请选择行");return}e(k)});function e(k){d("#conCountGrid-table").jqGrid("setGridParam",{page:1});d("#conCountGrid-table").jqGrid("setGridParam",{postData:{id:k,conCountStartTime:d("#conCountStart").val(),conCountEndTime:d("#conCountEnd").val()},datatype:"json"}).trigger("reloadGrid")}});