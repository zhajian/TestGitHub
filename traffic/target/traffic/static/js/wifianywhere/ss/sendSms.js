$(function(){$("#slider").css("width","630px").slider({value:0,range:"min",min:0,max:0,step:1,slide:function(d,e){var f=parseInt(e.value);$("#sliderVal").text(f);$("#sendSmsForm #customerNum").val(f);c()}});$("#buySms").click(function(){ui_alert("购买短信数量，请在工作时间内拨打客服热线："+_service_tel+"，将有专人为您服务。",function(){})});$("#sendSmsForm :radio").click(function(){$("#sliderVal").text(0);$("#sendSmsForm #customerNum").val(0);$("#slider").slider("option","value",0);$.ajax({type:"GET",url:G_CTX_PATH+"/wifiUser/visitorCount",data:{customerType:$(this).val(),merchantId:$("#merchantId").val()},success:function(d,f,e){if(d.success){$("#slider").slider("option","max",d.total);$("#sliderMax").text(d.total)}else{ajaxExceptionHandler(e)}}})});$("#sendSmsForm :radio:first").click();Hg.refRepeatSubmit("sendSmsForm");$("#sendSmsForm").validate({rules:{title:{required:true,rangelength:[1,15]},content:{required:true,rangelength:[1,122]},sign:{required:true,rangelength:[1,10]}}});$("#sendSmsForm [tag=save]").click(function(){if(!$("#sendSmsForm").validate().form()){return false}var d=parseInt($("#sendSmsForm #customerNum").val());if(d==0){ui_error("请设置目标客户数量");return false}var e=$(this);e.addClass("disabled").removeClass("btn-primary");$.ajax({type:"POST",url:G_CTX_PATH+"/merchantSms/doSend",data:$("#sendSmsForm").serialize(),success:function(f,h,g){if(f.success){ui_alert("短信已提交至短信通道进行发送，您可通过经营分析-短信记录模块查看短信发送情况",function(){location.href=G_CTX_PATH+"/merchantSms/toSend"})}else{ajaxExceptionHandler(g,function(){Hg.refreshSubmitToken("sendSmsForm");ui_error(f.data)})}},complete:function(f,g){e.addClass("btn-primary").removeClass("disabled")}})});$("#sendSmsForm [tag=trySend]").click(function(){if(!$("#sendSmsForm").validate().form()){return false}var e=/^(1\d{10})$/;var d=$("#trySendMobile").val();if($.trim(d).length==0){$("#trySendMobile").after('<label for="trySendMobile" generated="true" class="error">请输入手机号</label>');return false}if(!e.test(d)){$("#trySendMobile").after('<label for="trySendMobile" generated="true" class="error">手机号格式错误</label>');return false}$("#trySendMobile").siblings("label").remove();var g=$(this);g.addClass("disabled").removeClass("btn-primary");var f={title:$("#title").val(),sign:$("#sign").val(),content:$("#content").val(),mobiles:$("#trySendMobile").val()};$.ajax({type:"POST",url:G_CTX_PATH+"/merchantSms/tryToSend",data:f,success:function(h,j,i){if(h.success){$("#trySendMobile").val("");ui_alert("短信已发送，请查收",function(){})}else{ajaxExceptionHandler(i,function(){Hg.refreshSubmitToken("sendSmsForm");ui_error(h.data)})}},complete:function(h,i){g.addClass("btn-primary").removeClass("disabled")}})});function a(){var d=$("#content").val().length;var e=$("#sign").val().length;if(e>0){e+=2}return d+e}function c(){var e=$("#sendSmsForm #customerNum").val();var f=a();var d=0;if(f>0&&f<=70){d=e}else{if(f>70){d=e*2}}$("#expend").text(d)}function b(){var d=$("#content").val().length;var e=122-d;if(e<0){e=0}$("#prompt").html(e)}$("#sign, #content").on("keyup",function(){b();c()});click_tree_menu(function(d){$("#merchantId").val(d.attr("node"));$("#sendSmsForm :radio:checked").click()});b();$("input[name=customerType]").click(function(){$("#expend").text($("#sendSmsForm #customerNum").val())})});