define("echarts/chart/bar",["require","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(h){function d(m,l,q,i,p){c.call(this,m,l,q,i,p),this.refresh(i)}var c=h("./base"),k=h("zrender/shape/Rectangle");h("../component/axis"),h("../component/grid"),h("../component/dataZoom");var b=h("../config");b.bar={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,barMinHeight:0,barGap:"30%",barCategoryGap:"20%",itemStyle:{normal:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}},emphasis:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}}}};var j=h("../util/ecData"),g=h("zrender/tool/util"),f=h("zrender/tool/color");return d.prototype={type:b.CHART_TYPE_BAR,_buildShape:function(){this._buildPosition()},_buildNormal:function(aA,an,aw,ar,ap){for(var ao,au,ax,aB,aC,at,aq,am,q,B,ay,az,ai=this.series,aD=aw[0][0],aE=ai[aD],aj="horizontal"==ap,av=this.component.xAxis,al=this.component.yAxis,Y=aj?av.getAxis(aE.xAxisIndex):al.getAxis(aE.yAxisIndex),ak=this._mapSize(Y,aw),n=ak.gap,a=ak.barGap,ab=ak.barWidthMap,H=ak.barMaxWidthMap,Z=ak.barWidth,af=ak.barMinHeightMap,G=ak.interval,ad=this.deepQuery([this.ecTheme,b],"island.r"),ah=0,ag=an;ag>ah&&null!=Y.getNameByIndex(ah);ah++){aj?aB=Y.getCoordByIndex(ah)-n/2:aC=Y.getCoordByIndex(ah)+n/2;for(var R=0,ac=aw.length;ac>R;R++){var aa=ai[aw[R][0]].yAxisIndex||0,N=ai[aw[R][0]].xAxisIndex||0;ao=aj?al.getAxis(aa):av.getAxis(N),aq=at=q=am=ao.getCoord(0);for(var Q=0,ae=aw[R].length;ae>Q;Q++){aD=aw[R][Q],aE=ai[aD],ay=aE.data[ah],az=this.getDataFromOption(ay,"-"),ar[aD]=ar[aD]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},ax=Math.min(H[aD]||Number.MAX_VALUE,ab[aD]||Z),"-"!==az&&(az>0?(au=Q>0?ao.getCoordSize(az):aj?aq-ao.getCoord(az):ao.getCoord(az)-aq,1===ae&&af[aD]>au&&(au=af[aD]),aj?(at-=au,aC=at):(aB=at,at+=au)):0>az?(au=Q>0?ao.getCoordSize(az):aj?ao.getCoord(az)-q:q-ao.getCoord(az),1===ae&&af[aD]>au&&(au=af[aD]),aj?(aC=am,am+=au):(am-=au,aB=am)):(au=0,aj?(at-=au,aC=at):(aB=at,at+=au)),ar[aD][ah]=aj?aB+ax/2:aC-ax/2,ar[aD].min>az&&(ar[aD].min=az,aj?(ar[aD].minY=aC,ar[aD].minX=ar[aD][ah]):(ar[aD].minX=aB+au,ar[aD].minY=ar[aD][ah])),ar[aD].max<az&&(ar[aD].max=az,aj?(ar[aD].maxY=aC,ar[aD].maxX=ar[aD][ah]):(ar[aD].maxX=aB+au,ar[aD].maxY=ar[aD][ah])),ar[aD].sum+=az,ar[aD].counter++,ah%G===0&&(B=this._getBarItem(aD,ah,Y.getNameByIndex(ah),aB,aC-(aj?0:ax),aj?ax:au,aj?au:ax,aj?"vertical":"horizontal"),this.shapeList.push(new k(B))))}for(var Q=0,ae=aw[R].length;ae>Q;Q++){aD=aw[R][Q],aE=ai[aD],ay=aE.data[ah],az=this.getDataFromOption(ay,"-"),ax=Math.min(H[aD]||Number.MAX_VALUE,ab[aD]||Z),"-"==az&&this.deepQuery([ay,aE,this.option],"calculable")&&(aj?(at-=ad,aC=at):(aB=at,at+=ad),B=this._getBarItem(aD,ah,Y.getNameByIndex(ah),aB,aC-(aj?0:ax),aj?ax:ad,aj?ad:ax,aj?"vertical":"horizontal"),B.hoverable=!1,B.draggable=!1,B.style.lineWidth=1,B.style.brushType="stroke",B.style.strokeColor=aE.calculableHolderColor||this.ecTheme.calculableHolderColor||b.calculableHolderColor,this.shapeList.push(new k(B)))}aj?aB+=ax+a:aC-=ax+a}}this._calculMarkMapXY(ar,aw,aj?"y":"x")},_buildHorizontal:function(m,l,a,o){return this._buildNormal(m,l,a,o,"horizontal")},_buildVertical:function(m,l,a,o){return this._buildNormal(m,l,a,o,"vertical")},_buildOther:function(Y,H,Q,ac){for(var M=this.series,J=0,I=Q.length;I>J;J++){for(var O=0,R=Q[J].length;R>O;O++){var Z=Q[J][O],aa=M[Z],N=aa.xAxisIndex||0,K=this.component.xAxis.getAxis(N),G=K.getCoord(0),z=aa.yAxisIndex||0,A=this.component.yAxis.getAxis(z),S=A.getCoord(0);ac[Z]=ac[Z]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var T=0,C=aa.data.length;C>T;T++){var ab=aa.data[T],ad=this.getDataFromOption(ab,"-");if(ad instanceof Array){var D,P,F=K.getCoord(ad[0]),B=A.getCoord(ad[1]),E=[ab,aa],q=this.deepQuery(E,"barWidth")||10,n=this.deepQuery(E,"barHeight");null!=n?(D="horizontal",ad[0]>0?(q=F-G,F-=q):q=ad[0]<0?G-F:0,P=this._getBarItem(Z,T,ad[0],F,B-n/2,q,n,D)):(D="vertical",ad[1]>0?n=S-B:ad[1]<0?(n=B-S,B-=n):n=0,P=this._getBarItem(Z,T,ad[0],F-q/2,B,q,n,D)),this.shapeList.push(new k(P)),F=K.getCoord(ad[0]),B=A.getCoord(ad[1]),ac[Z].min0>ad[0]&&(ac[Z].min0=ad[0],ac[Z].minY0=B,ac[Z].minX0=F),ac[Z].max0<ad[0]&&(ac[Z].max0=ad[0],ac[Z].maxY0=B,ac[Z].maxX0=F),ac[Z].sum0+=ad[0],ac[Z].counter0++,ac[Z].min1>ad[1]&&(ac[Z].min1=ad[1],ac[Z].minY1=B,ac[Z].minX1=F),ac[Z].max1<ad[1]&&(ac[Z].max1=ad[1],ac[Z].maxY1=B,ac[Z].maxX1=F),ac[Z].sum1+=ad[1],ac[Z].counter1++}}}}this._calculMarkMapXY(ac,Q,"xy")},_mapSize:function(B,F,z){var w,E,v=this._findSpecialBarSzie(F,z),q=v.barWidthMap,G=v.barMaxWidthMap,y=v.barMinHeightMap,A=v.sBarWidthCounter,C=v.sBarWidthTotal,D=v.barGap,x=v.barCategoryGap,u=1;if(F.length!=A){if(z){w=B.getGap(),D=0,E=+(w/F.length).toFixed(2),0>=E&&(u=Math.floor(F.length/w),E=1)}else{if(w="string"==typeof x&&x.match(/%$/)?(B.getGap()*(100-parseFloat(x))/100).toFixed(2)-0:B.getGap()-x,"string"==typeof D&&D.match(/%$/)?(D=parseFloat(D)/100,E=+((w-C)/((F.length-1)*D+F.length-A)).toFixed(2),D=E*D):(D=parseFloat(D),E=+((w-C-D*(F.length-1))/(F.length-A)).toFixed(2)),0>=E){return this._mapSize(B,F,!0)}}}else{if(w=A>1?"string"==typeof x&&x.match(/%$/)?+(B.getGap()*(100-parseFloat(x))/100).toFixed(2):B.getGap()-x:C,E=0,D=A>1?+((w-C)/(A-1)).toFixed(2):0,0>D){return this._mapSize(B,F,!0)}}return this._recheckBarMaxWidth(F,q,G,y,w,E,D,u)},_findSpecialBarSzie:function(L,z){for(var H,E,P,D,B=this.series,A={},G={},I={},M=0,N=0,F=0,C=L.length;C>F;F++){for(var x={barWidth:!1,barMaxWidth:!1},q=0,v=L[F].length;v>q;q++){var J=L[F][q],K=B[J];if(!z){if(x.barWidth){A[J]=H}else{if(H=this.query(K,"barWidth"),null!=H){A[J]=H,N+=H,M++,x.barWidth=!0;for(var w=0,O=q;O>w;w++){var Q=L[F][w];A[Q]=H}}}if(x.barMaxWidth){G[J]=E}else{if(E=this.query(K,"barMaxWidth"),null!=E){G[J]=E,x.barMaxWidth=!0;for(var w=0,O=q;O>w;w++){var Q=L[F][w];G[Q]=E}}}}I[J]=this.query(K,"barMinHeight"),P=null!=P?P:this.query(K,"barGap"),D=null!=D?D:this.query(K,"barCategoryGap")}}return{barWidthMap:A,barMaxWidthMap:G,barMinHeightMap:I,sBarWidth:H,sBarMaxWidth:E,sBarWidthCounter:M,sBarWidthTotal:N,barGap:P,barCategoryGap:D}},_recheckBarMaxWidth:function(x,A,v,q,z,p,m,B){for(var u=0,w=x.length;w>u;u++){var y=x[u][0];v[y]&&v[y]<p&&(z-=p-v[y])}return{barWidthMap:A,barMaxWidthMap:v,barMinHeightMap:q,gap:z,barWidth:p,barGap:m,interval:B}},_getBarItem:function(M,B,I,E,Q,C,G,J){var N,O=this.series,F=O[M],D=F.data[B],A=this._sIndex2ColorMap[M],o=[D,F],q=this.deepMerge(o,"itemStyle.normal"),K=this.deepMerge(o,"itemStyle.emphasis"),L=q.barBorderWidth;N={zlevel:F.zlevel,z:F.z,clickable:this.deepQuery(o,"clickable"),style:{x:E,y:Q,width:C,height:G,brushType:"both",color:this.getItemStyleColor(this.deepQuery(o,"itemStyle.normal.color")||A,M,B,D),radius:q.barBorderRadius,lineWidth:L,strokeColor:q.barBorderColor},highlightStyle:{color:this.getItemStyleColor(this.deepQuery(o,"itemStyle.emphasis.color"),M,B,D),radius:K.barBorderRadius,lineWidth:K.barBorderWidth,strokeColor:K.barBorderColor},_orient:J};var s=N.style;N.highlightStyle.color=N.highlightStyle.color||("string"==typeof s.color?f.lift(s.color,-0.3):s.color),s.x=Math.floor(s.x),s.y=Math.floor(s.y),s.height=Math.ceil(s.height),s.width=Math.ceil(s.width),L>0&&s.height>L&&s.width>L?(s.y+=L/2,s.height-=L,s.x+=L/2,s.width-=L):s.brushType="fill",N.highlightStyle.textColor=N.highlightStyle.color,N=this.addLabel(N,F,D,I,J);for(var P=[s,N.highlightStyle],R=0,w=P.length;w>R;R++){var H=P[R].textPosition;if("insideLeft"===H||"insideRight"===H||"insideTop"===H||"insideBottom"===H){var z=5;switch(H){case"insideLeft":P[R].textX=s.x+z,P[R].textY=s.y+s.height/2,P[R].textAlign="left",P[R].textBaseline="middle";break;case"insideRight":P[R].textX=s.x+s.width-z,P[R].textY=s.y+s.height/2,P[R].textAlign="right",P[R].textBaseline="middle";break;case"insideTop":P[R].textX=s.x+s.width/2,P[R].textY=s.y+z/2,P[R].textAlign="center",P[R].textBaseline="top";break;case"insideBottom":P[R].textX=s.x+s.width/2,P[R].textY=s.y+s.height-z/2,P[R].textAlign="center",P[R].textBaseline="bottom"}P[R].textPosition="specific",P[R].textColor=P[R].textColor||"#fff"}}return this.deepQuery([D,F,this.option],"calculable")&&(this.setCalculable(N),N.draggable=!0),j.pack(N,O[M],M,O[M].data[B],B,I),N},getMarkCoord:function(x,A){var v,q,z=this.series[x],p=this.xMarkMap[x],m=this.component.xAxis.getAxis(z.xAxisIndex),B=this.component.yAxis.getAxis(z.yAxisIndex);if(!A.type||"max"!==A.type&&"min"!==A.type&&"average"!==A.type){if(p.isHorizontal){v="string"==typeof A.xAxis&&m.getIndexByName?m.getIndexByName(A.xAxis):A.xAxis||0;var u=p[v];u=null!=u?u:"string"!=typeof A.xAxis&&m.getCoordByIndex?m.getCoordByIndex(A.xAxis||0):m.getCoord(A.xAxis||0),q=[u,B.getCoord(A.yAxis||0)]}else{v="string"==typeof A.yAxis&&B.getIndexByName?B.getIndexByName(A.yAxis):A.yAxis||0;var w=p[v];w=null!=w?w:"string"!=typeof A.yAxis&&B.getCoordByIndex?B.getCoordByIndex(A.yAxis||0):B.getCoord(A.yAxis||0),q=[m.getCoord(A.xAxis||0),w]}}else{var y=null!=A.valueIndex?A.valueIndex:null!=p.maxX0?"1":"";q=[p[A.type+"X"+y],p[A.type+"Y"+y],p[A.type+"Line"+y],p[A.type+y]]}return q},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(B,G){function z(){w--,0===w&&G&&G()}for(var v=this.series,E={},o=0,H=B.length;H>o;o++){E[B[o][0]]=B[o]}for(var y,A,C,D,x,q,F,w=0,o=this.shapeList.length-1;o>=0;o--){if(q=j.get(this.shapeList[o],"seriesIndex"),E[q]&&!E[q][3]&&"rectangle"===this.shapeList[o].type){if(F=j.get(this.shapeList[o],"dataIndex"),x=v[q],E[q][2]&&F===x.data.length-1){this.zr.delShape(this.shapeList[o].id);continue}if(!E[q][2]&&0===F){this.zr.delShape(this.shapeList[o].id);continue}"horizontal"===this.shapeList[o]._orient?(D=this.component.yAxis.getAxis(x.yAxisIndex||0).getGap(),C=E[q][2]?-D:D,y=0):(A=this.component.xAxis.getAxis(x.xAxisIndex||0).getGap(),y=E[q][2]?A:-A,C=0),this.shapeList[o].position=[0,0],w++,this.zr.animate(this.shapeList[o].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[y,C]}).done(z).start()}}w||G&&G()}},g.inherits(d,c),h("../chart").define("bar",d),d});