define("echarts/chart/tree",["require","./base","../util/shape/Icon","zrender/shape/Image","zrender/shape/Line","zrender/shape/BezierCurve","../layout/Tree","../data/Tree","../config","../util/ecData","zrender/config","zrender/tool/event","zrender/tool/util","../chart"],function(u){function w(l,i,r,h,m){p.call(this,l,i,r,h,m),this.refresh(h)}var p=u("./base"),d=0.618,v=u("../util/shape/Icon"),c=u("zrender/shape/Image"),b=u("zrender/shape/Line"),x=u("zrender/shape/BezierCurve"),k=u("../layout/Tree"),q=u("../data/Tree"),g=u("../config");g.tree={zlevel:1,z:2,calculable:!1,clickable:!0,rootLocation:{},orient:"vertical",symbol:"circle",symbolSize:20,nodePadding:30,layerPadding:100,itemStyle:{normal:{label:{show:!0},lineStyle:{width:1,color:"#777",type:"curve"}},emphasis:{}}};var f=u("../util/ecData"),j=(u("zrender/config"),u("zrender/tool/event"),u("zrender/tool/util"));return w.prototype={type:g.CHART_TYPE_TREE,_buildShape:function(o,m){var l=o.data[0];this.tree=q.fromOptionData(l.name,l.children),this.tree.root.data=l,this._setTreeShape(o),this.tree.traverse(function(a){this._buildItem(a,o,m),a.children.length>0&&this._buildLink(a,o)},this);var r=o.roam===!0||"move"===o.roam,h=o.roam===!0||"scale"===o.roam;this.zr.modLayer(this.getZlevelBase(),{panable:r,zoomable:h}),(this.query("markPoint.effect.show")||this.query("markLine.effect.show"))&&this.zr.modLayer(g.EFFECT_ZLEVEL,{panable:r,zoomable:h}),this.addShapeList()},_buildItem:function(E,H,C){var y=[E.data,H],a=this.deepQuery(y,"symbol"),I=this.deepMerge(y,"itemStyle.normal")||{},B=this.deepMerge(y,"itemStyle.emphasis")||{},D=I.color||this.zr.getColor(),z=B.color||this.zr.getColor(),A=-E.layout.angle||0;E.id===this.tree.root.id&&(A=0);var F="right";Math.abs(A)>=Math.PI/2&&Math.abs(A)<3*Math.PI/2&&(A+=Math.PI,F="left");var o=[A,E.layout.position[0],E.layout.position[1]],G=new v({zlevel:this.getZlevelBase(),z:this.getZBase()+1,rotation:o,clickable:this.deepQuery(y,"clickable"),style:{x:E.layout.position[0]-0.5*E.layout.width,y:E.layout.position[1]-0.5*E.layout.height,width:E.layout.width,height:E.layout.height,iconType:a,color:D,brushType:"both",lineWidth:I.borderWidth,strokeColor:I.borderColor},highlightStyle:{color:z,lineWidth:B.borderWidth,strokeColor:B.borderColor}});G.style.iconType.match("image")&&(G.style.image=G.style.iconType.replace(new RegExp("^image:\\/\\/"),""),G=new c({rotation:o,style:G.style,highlightStyle:G.highlightStyle,clickable:G.clickable,zlevel:this.getZlevelBase(),z:this.getZBase()})),this.deepQuery(y,"itemStyle.normal.label.show")&&(G.style.text=null==E.data.label?E.id:E.data.label,G.style.textPosition=this.deepQuery(y,"itemStyle.normal.label.position"),"radial"===H.orient&&"inside"!==G.style.textPosition&&(G.style.textPosition=F),G.style.textColor=this.deepQuery(y,"itemStyle.normal.label.textStyle.color"),G.style.textFont=this.getFont(this.deepQuery(y,"itemStyle.normal.label.textStyle")||{})),this.deepQuery(y,"itemStyle.emphasis.label.show")&&(G.highlightStyle.textPosition=this.deepQuery(y,"itemStyle.emphasis.label.position"),G.highlightStyle.textColor=this.deepQuery(y,"itemStyle.emphasis.label.textStyle.color"),G.highlightStyle.textFont=this.getFont(this.deepQuery(y,"itemStyle.emphasis.label.textStyle")||{})),f.pack(G,H,C,E.data,0,E.id),this.shapeList.push(G)},_buildLink:function(B,D){var A=D.itemStyle.normal.lineStyle;if("broken"===A.type){return void this._buildBrokenLine(B,A,D)}for(var y=0;y<B.children.length;y++){var C=B.layout.position[0],m=B.layout.position[1],h=B.children[y].layout.position[0],E=B.children[y].layout.position[1];switch(A.type){case"curve":this._buildBezierCurve(B,B.children[y],A,D);break;case"broken":break;default:var z=this._getLine(C,m,h,E,A);this.shapeList.push(z)}}},_buildBrokenLine:function(H,N,E){var L=j.clone(N);L.type="solid";var A=[],n=H.layout.position[0],O=H.layout.position[1],D=E.orient,F=H.children[0].layout.position[1],C=n,B=O+(F-O)*(1-d),I=H.children[0].layout.position[0],z=B,J=H.children[H.children.length-1].layout.position[0],M=B;if("horizontal"===D){var K=H.children[0].layout.position[0];C=n+(K-n)*(1-d),B=O,I=C,z=H.children[0].layout.position[1],J=C,M=H.children[H.children.length-1].layout.position[1]}A.push(this._getLine(n,O,C,B,L)),A.push(this._getLine(I,z,J,M,L));for(var G=0;G<H.children.length;G++){K=H.children[G].layout.position[0],F=H.children[G].layout.position[1],"horizontal"===D?z=F:I=K,A.push(this._getLine(I,z,K,F,L))}this.shapeList=this.shapeList.concat(A)},_getLine:function(o,m,l,r,h){return o===l&&(o=l=this.subPixelOptimize(o,h.width)),m===r&&(m=r=this.subPixelOptimize(m,h.width)),new b({zlevel:this.getZlevelBase(),hoverable:!1,style:j.merge({xStart:o,yStart:m,xEnd:l,yEnd:r,lineType:h.type,strokeColor:h.color,lineWidth:h.width},h,!0)})},_buildBezierCurve:function(O,C,J,S){var F=d,D=S.orient,H=O.layout.position[0],K=O.layout.position[1],G=C.layout.position[0],n=C.layout.position[1],P=H,E=(n-K)*F+K,Q=G,B=(n-K)*(1-F)+K;if("horizontal"===D){P=(G-H)*F+H,E=K,Q=(G-H)*(1-F)+H,B=n}else{if("radial"===D){if(O.id===this.tree.root.id){P=(G-H)*F+H,E=(n-K)*F+K,Q=(G-H)*(1-F)+H,B=(n-K)*(1-F)+K}else{var z=O.layout.originPosition[0],M=O.layout.originPosition[1],R=C.layout.originPosition[0],N=C.layout.originPosition[1],I=this.tree.root.layout.position[0],T=this.tree.root.layout.position[1];P=z,E=(N-M)*F+M,Q=R,B=(N-M)*(1-F)+M;var A=(P-this.minX)/this.width*Math.PI*2;P=E*Math.cos(A)+I,E=E*Math.sin(A)+T,A=(Q-this.minX)/this.width*Math.PI*2,Q=B*Math.cos(A)+I,B=B*Math.sin(A)+T}}}var s=new x({zlevel:this.getZlevelBase(),hoverable:!1,style:j.merge({xStart:H,yStart:K,cpX1:P,cpY1:E,cpX2:Q,cpY2:B,xEnd:G,yEnd:n,strokeColor:J.color,lineWidth:J.width},J,!0)});this.shapeList.push(s)},_setTreeShape:function(E){var G=new k({nodePadding:E.nodePadding,layerPadding:E.layerPadding});this.tree.traverse(function(e){var a=[e.data,E],h=this.deepQuery(a,"symbolSize");"number"==typeof h&&(h=[h,h]),e.layout={width:h[0],height:h[1]}},this),G.run(this.tree);var C=E.orient,z=E.rootLocation.x,F=E.rootLocation.y,y=this.zr.getWidth(),l=this.zr.getHeight();z="center"===z?0.5*y:this.parsePercent(z,y),F="center"===F?0.5*l:this.parsePercent(F,l),F=this.parsePercent(F,l),"horizontal"===C&&(z=isNaN(z)?10:z,F=isNaN(F)?0.5*l:F),"radial"===C?(z=isNaN(z)?0.5*y:z,F=isNaN(F)?0.5*l:F):(z=isNaN(z)?0.5*y:z,F=isNaN(F)?10:F);var H=this.tree.root.layout.position[0];if("radial"===C){var D=1/0,B=0,A=0;this.tree.traverse(function(a){B=Math.max(B,a.layout.position[0]),D=Math.min(D,a.layout.position[0]),A=Math.max(A,a.layout.width)}),this.width=B-D+2*A,this.minX=D}this.tree.traverse(function(h){var n,i;if("vertical"===C&&"inverse"===E.direction){n=h.layout.position[0]-H+z,i=F-h.layout.position[1]}else{if("vertical"===C){n=h.layout.position[0]-H+z,i=h.layout.position[1]+F}else{if("horizontal"===C&&"inverse"===E.direction){i=h.layout.position[0]-H+F,n=z-h.layout.position[1]}else{if("horizontal"===C){i=h.layout.position[0]-H+F,n=h.layout.position[1]+z}else{n=h.layout.position[0],i=h.layout.position[1],h.layout.originPosition=[n,i];var e=i,a=(n-D)/this.width*Math.PI*2;n=e*Math.cos(a)+z,i=e*Math.sin(a)+F,h.layout.angle=a}}}}h.layout.position[0]=n,h.layout.position[1]=i},this)},refresh:function(o){this.clear(),o&&(this.option=o,this.series=this.option.series);for(var m=this.series,l=this.component.legend,r=0;r<m.length;r++){if(m[r].type===g.CHART_TYPE_TREE){m[r]=this.reformOption(m[r]);var h=m[r].name||"";if(this.selectedMap[h]=l?l.isSelected(h):!0,!this.selectedMap[h]){continue}this._buildSeries(m[r],r)}}},_buildSeries:function(h,a){this._buildShape(h,a)}},j.inherits(w,p),u("../chart").define("tree",w),w}),define("echarts/layout/Tree",["require","zrender/tool/vector"],function(c){function b(d){d=d||{},this.nodePadding=d.nodePadding||30,this.layerPadding=d.layerPadding||100,this._layerOffsets=[],this._layers=[]}var a=c("zrender/tool/vector");return b.prototype.run=function(g){this._layerOffsets.length=0;for(var f=0;f<g.root.height+1;f++){this._layerOffsets[f]=0,this._layers[f]=[]}this._updateNodeXPosition(g.root);var d=g.root;this._updateNodeYPosition(d,0,d.layout.height)},b.prototype._updateNodeXPosition=function(j){var g=1/0,m=-(1/0);j.layout.position=j.layout.position||a.create();for(var f=0;f<j.children.length;f++){var k=j.children[f];this._updateNodeXPosition(k);var i=k.layout.position[0];g>i&&(g=i),i>m&&(m=i)}j.layout.position[0]=j.children.length>0?(g+m)/2:0;var h=this._layerOffsets[j.depth]||0;if(h>j.layout.position[0]){var d=h-j.layout.position[0];this._shiftSubtree(j,d);for(var f=j.depth+1;f<j.height+j.depth;f++){this._layerOffsets[f]+=d}}this._layerOffsets[j.depth]=j.layout.position[0]+j.layout.width+this.nodePadding,this._layers[j.depth].push(j)},b.prototype._shiftSubtree=function(g,f){g.layout.position[0]+=f;for(var d=0;d<g.children.length;d++){this._shiftSubtree(g.children[d],f)}},b.prototype._updateNodeYPosition=function(h,g,f){h.layout.position[1]=g;for(var k=0,d=0;d<h.children.length;d++){k=Math.max(h.children[d].layout.height,k)}var j=this.layerPadding;"function"==typeof j&&(j=j(h.depth));for(var d=0;d<h.children.length;d++){this._updateNodeYPosition(h.children[d],g+j+f,k)}},b}),define("echarts/data/Tree",["require","zrender/tool/util"],function(c){function b(g,f){this.id=g,this.depth=0,this.height=0,this.children=[],this.parent=null,this.data=f||null}function a(f){this.root=new b(f)}var d=c("zrender/tool/util");return b.prototype.add=function(g){var f=this.children;g.parent!==this&&(f.push(g),g.parent=this)},b.prototype.remove=function(h){var g=this.children,f=d.indexOf(g,h);f>=0&&(g.splice(f,1),h.parent=null)},b.prototype.traverse=function(h,g){h.call(g,this);for(var f=0;f<this.children.length;f++){this.children[f].traverse(h,g)}},b.prototype.updateDepthAndHeight=function(h){var g=0;this.depth=h;for(var f=0;f<this.children.length;f++){var j=this.children[f];j.updateDepthAndHeight(h+1),j.height>g&&(g=j.height)}this.height=g+1},b.prototype.getNodeById=function(h){if(this.id===h){return this}for(var g=0;g<this.children.length;g++){var f=this.children[g].getNodeById(h);if(f){return f}}},a.prototype.traverse=function(g,f){this.root.traverse(g,f)},a.prototype.getSubTree=function(g){var f=this.getNodeById(g);if(f){var h=new a(f.id);return h.root=f,h}},a.prototype.getNodeById=function(f){return this.root.getNodeById(f)},a.fromOptionData=function(i,k){function f(p,l){var s=new b(p.name,p);l.add(s);var q=p.children;if(q){for(var m=0;m<q.length;m++){f(q[m],s)}}}var j=new a(i),h=j.root;h.data={name:i,children:k};for(var g=0;g<k.length;g++){f(k[g],h)}return j.root.updateDepthAndHeight(0),j},a.fromGraph=function(q){function i(l){for(var h=q.getNodeById(l.id),e=0;e<h.outEdges.length;e++){var n=h.outEdges[e],m=g[n.node2.id];l.children.push(m),i(m)}}for(var t={},g={},f=0;f<q.nodes.length;f++){var u,k=q.nodes[f];0===k.inDegree()?(t[k.id]=new a(k.id),u=t[k.id].root):u=new b(k.id),u.data=k.data,g[k.id]=u}var p=[];for(var j in t){i(t[j].root),t[j].root.updateDepthAndHeight(0),p.push(t[j])}return p},a});