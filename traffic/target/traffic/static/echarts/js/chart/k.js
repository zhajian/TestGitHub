define("echarts/chart/k",["require","./base","../util/shape/Candle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","../chart"],function(g){function d(l,k,p,i,m){c.call(this,l,k,p,i,m),this.refresh(i)}var c=g("./base"),j=g("../util/shape/Candle");g("../component/axis"),g("../component/grid"),g("../component/dataZoom");var b=g("../config");b.k={zlevel:0,z:2,clickable:!0,hoverable:!0,legendHoverLink:!1,xAxisIndex:0,yAxisIndex:0,itemStyle:{normal:{color:"#fff",color0:"#00aa11",lineStyle:{width:1,color:"#ff3200",color0:"#00aa11"},label:{show:!1}},emphasis:{label:{show:!1}}}};var h=g("../util/ecData"),f=g("zrender/tool/util");return d.prototype={type:b.CHART_TYPE_K,_buildShape:function(){var m=this.series;this.selectedMap={};for(var k,a={top:[],bottom:[]},q=0,p=m.length;p>q;q++){m[q].type===b.CHART_TYPE_K&&(m[q]=this.reformOption(m[q]),this.legendHoverLink=m[q].legendHoverLink||this.legendHoverLink,k=this.component.xAxis.getAxis(m[q].xAxisIndex),k.type===b.COMPONENT_TYPE_AXIS_CATEGORY&&a[k.getPosition()].push(q))}for(var l in a){a[l].length>0&&this._buildSinglePosition(l,a[l])}this.addShapeList()},_buildSinglePosition:function(q,m){var l=this._mapData(m),u=l.locationMap,k=l.maxDataLength;if(0!==k&&0!==u.length){this._buildHorizontal(m,k,u);for(var s=0,p=m.length;p>s;s++){this.buildMark(m[s])}}},_mapData:function(v){for(var x,u,p=this.series,w=this.component.legend,m=[],k=0,y=0,q=v.length;q>y;y++){x=p[v[y]],u=x.name,this.selectedMap[u]=w?w.isSelected(u):!0,this.selectedMap[u]&&m.push(v[y]),k=Math.max(k,x.data.length)}return{locationMap:m,maxDataLength:k}},_buildHorizontal:function(J,x,G){for(var D,M,C,A,z,F,H,K,L,E,B=this.series,w={},I=0,k=G.length;k>I;I++){D=G[I],M=B[D],C=M.xAxisIndex||0,A=this.component.xAxis.getAxis(C),H=M.barWidth||Math.floor(A.getGap()/2),E=M.barMaxWidth,E&&H>E&&(H=E),z=M.yAxisIndex||0,F=this.component.yAxis.getAxis(z),w[D]=[];for(var q=0,v=x;v>q&&null!=A.getNameByIndex(q);q++){K=M.data[q],L=this.getDataFromOption(K,"-"),"-"!==L&&4==L.length&&w[D].push([A.getCoordByIndex(q),H,F.getCoord(L[0]),F.getCoord(L[1]),F.getCoord(L[2]),F.getCoord(L[3]),q,A.getNameByIndex(q)])}}this._buildKLine(J,w)},_buildKLine:function(P,C){for(var L,H,G,E,D,J,M,Q,R,I,F,B,N,a,q,w,O,T=this.series,S=0,z=P.length;z>S;S++){if(O=P[S],F=T[O],a=C[O],this._isLarge(a)&&(a=this._getLargePointList(a)),F.type===b.CHART_TYPE_K&&null!=a){B=F,L=this.query(B,"itemStyle.normal.lineStyle.width"),H=this.query(B,"itemStyle.normal.lineStyle.color"),G=this.query(B,"itemStyle.normal.lineStyle.color0"),E=this.query(B,"itemStyle.normal.color"),D=this.query(B,"itemStyle.normal.color0"),J=this.query(B,"itemStyle.emphasis.lineStyle.width"),M=this.query(B,"itemStyle.emphasis.lineStyle.color"),Q=this.query(B,"itemStyle.emphasis.lineStyle.color0"),R=this.query(B,"itemStyle.emphasis.color"),I=this.query(B,"itemStyle.emphasis.color0");for(var K=0,A=a.length;A>K;K++){q=a[K],N=F.data[q[6]],B=N,w=q[3]<q[2],this.shapeList.push(this._getCandle(O,q[6],q[7],q[0],q[1],q[2],q[3],q[4],q[5],w?this.query(B,"itemStyle.normal.color")||E:this.query(B,"itemStyle.normal.color0")||D,this.query(B,"itemStyle.normal.lineStyle.width")||L,w?this.query(B,"itemStyle.normal.lineStyle.color")||H:this.query(B,"itemStyle.normal.lineStyle.color0")||G,w?this.query(B,"itemStyle.emphasis.color")||R||E:this.query(B,"itemStyle.emphasis.color0")||I||D,this.query(B,"itemStyle.emphasis.lineStyle.width")||J||L,w?this.query(B,"itemStyle.emphasis.lineStyle.color")||M||H:this.query(B,"itemStyle.emphasis.lineStyle.color0")||Q||G))}}}},_isLarge:function(a){return a[0][1]<0.5},_getLargePointList:function(o){for(var m=this.component.grid.getWidth(),l=o.length,p=[],k=0;m>k;k++){p[k]=o[Math.floor(l/m*k)]}return p},_getCandle:function(G,v,C,K,x,w,B,D,H,I,A,z,q,E,k){var n=this.series,o=n[G],F=o.data[v],L=[F,o],J={zlevel:o.zlevel,z:o.z,clickable:this.deepQuery(L,"clickable"),hoverable:this.deepQuery(L,"hoverable"),style:{x:K,y:[w,B,D,H],width:x,color:I,strokeColor:z,lineWidth:A,brushType:"both"},highlightStyle:{color:q,strokeColor:k,lineWidth:E},_seriesIndex:G};return J=this.addLabel(J,o,F,C),h.pack(J,o,G,F,v,C),J=new j(J)},getMarkCoord:function(o,m){var l=this.series[o],p=this.component.xAxis.getAxis(l.xAxisIndex),k=this.component.yAxis.getAxis(l.yAxisIndex);return["string"!=typeof m.xAxis&&p.getCoordByIndex?p.getCoordByIndex(m.xAxis||0):p.getCoord(m.xAxis||0),"string"!=typeof m.yAxis&&k.getCoordByIndex?k.getCoordByIndex(m.yAxis||0):k.getCoord(m.yAxis||0)]},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(z,E){function x(){D--,0===D&&E&&E()}for(var q=this.series,C={},k=0,F=z.length;F>k;k++){C[z[k][0]]=z[k]}for(var w,y,A,B,v,o,D=0,k=0,F=this.shapeList.length;F>k;k++){if(v=this.shapeList[k]._seriesIndex,C[v]&&!C[v][3]&&"candle"===this.shapeList[k].type){if(o=h.get(this.shapeList[k],"dataIndex"),B=q[v],C[v][2]&&o===B.data.length-1){this.zr.delShape(this.shapeList[k].id);continue}if(!C[v][2]&&0===o){this.zr.delShape(this.shapeList[k].id);continue}y=this.component.xAxis.getAxis(B.xAxisIndex||0).getGap(),w=C[v][2]?y:-y,A=0,D++,this.zr.animate(this.shapeList[k].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[w,A]}).done(x).start()}}D||E&&E()}},f.inherits(d,c),g("../chart").define("k",d),d});