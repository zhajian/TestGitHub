define("echarts/chart/eventRiver",["require","./base","../layout/eventRiver","zrender/shape/Polygon","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","../util/date","zrender/tool/util","zrender/tool/color","../chart"],function(k){function p(s,i,v,h,u){g.call(this,s,i,v,h,u);var l=this;l._ondragend=function(){l.isDragend=!0},this.refresh(h)}var g=k("./base"),d=k("../layout/eventRiver"),m=k("zrender/shape/Polygon");k("../component/axis"),k("../component/grid"),k("../component/dataZoom");var c=k("../config");c.eventRiver={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"inside",formatter:"{b}"}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0}}}};var b=k("../util/ecData"),q=k("../util/date"),f=k("zrender/tool/util"),j=k("zrender/tool/color");return p.prototype={type:c.CHART_TYPE_EVENTRIVER,_buildShape:function(){var r=this.series;this.selectedMap={},this._dataPreprocessing();for(var n=this.component.legend,l=[],h=0;h<r.length;h++){if(r[h].type===this.type){r[h]=this.reformOption(r[h]),this.legendHoverLink=r[h].legendHoverLink||this.legendHoverLink;var s=r[h].name||"";if(this.selectedMap[s]=n?n.isSelected(s):!0,!this.selectedMap[s]){continue}this.buildMark(h),l.push(this.series[h])}}d(l,this._intervalX,this.component.grid.getArea()),this._drawEventRiver(),this.addShapeList()},_dataPreprocessing:function(){for(var z,B,x=this.series,v=0,A=x.length;A>v;v++){if(x[v].type===this.type){z=this.component.xAxis.getAxis(x[v].xAxisIndex||0);for(var u=0,s=x[v].data.length;s>u;u++){B=x[v].data[u].evolution;for(var w=0,y=B.length;y>w;w++){B[w].timeScale=z.getCoord(q.getNewDate(B[w].time)-0),B[w].valueScale=Math.pow(B[w].value,0.8)}}}}this._intervalX=Math.round(this.component.grid.getWidth()/40)},_drawEventRiver:function(){for(var l=this.series,h=0;h<l.length;h++){var a=l[h].name||"";if(l[h].type===this.type&&this.selectedMap[a]){for(var o=0;o<l[h].data.length;o++){this._drawEventBubble(l[h].data[o],h,o)}}}},_drawEventBubble:function(C,H,A){var r=this.series,h=r[H],I=h.name||"",z=h.data[A],w=[z,h],v=this.component.legend,x=v?v.getColor(I):this.zr.getColor(H),D=this.deepMerge(w,"itemStyle.normal")||{},a=this.deepMerge(w,"itemStyle.emphasis")||{},E=this.getItemStyleColor(D.color,H,A,z)||x,G=this.getItemStyleColor(a.color,H,A,z)||("string"==typeof E?j.lift(E,-0.2):E),F=this._calculateControlPoints(C),B={zlevel:h.zlevel,z:h.z,clickable:this.deepQuery(w,"clickable"),style:{pointList:F,smooth:"spline",brushType:"both",lineJoin:"round",color:E,lineWidth:D.borderWidth,strokeColor:D.borderColor},highlightStyle:{color:G,lineWidth:a.borderWidth,strokeColor:a.borderColor},draggable:"vertical",ondragend:this._ondragend};B=new m(B),this.addLabel(B,h,z,C.name),b.pack(B,r[H],H,r[H].data[A],A,r[H].data[A].name),this.shapeList.push(B)},_calculateControlPoints:function(y){var A=this._intervalX,x=y.y,v=y.evolution,z=v.length;if(!(1>z)){for(var u=[],h=[],B=0;z>B;B++){u.push(v[B].timeScale),h.push(v[B].valueScale)}var w=[];w.push([u[0],x]);var B=0;for(B=0;z-1>B;B++){w.push([(u[B]+u[B+1])/2,h[B]/-2+x])}for(w.push([(u[B]+(u[B]+A))/2,h[B]/-2+x]),w.push([u[B]+A,x]),w.push([(u[B]+(u[B]+A))/2,h[B]/2+x]),B=z-1;B>0;B--){w.push([(u[B]+u[B-1])/2,h[B-1]/2+x])}return w}},ondragend:function(h,a){this.isDragend&&h.target&&(a.dragOut=!0,a.dragIn=!0,a.needRefresh=!1,this.isDragend=!1)},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()}},f.inherits(p,g),k("../chart").define("eventRiver",p),p}),define("echarts/layout/eventRiver",["require"],function(){function f(G,C,x){function v(l,k){var h=l.importance,m=k.importance;return h>m?-1:m>h?1:0}for(var t=4,A=0;A<G.length;A++){for(var D=0;D<G[A].data.length;D++){null==G[A].data[D].weight&&(G[A].data[D].weight=1);for(var z=0,a=0;a<G[A].data[D].evolution.length;a++){z+=G[A].data[D].evolution[a].valueScale}G[A].data[D].importance=z*G[A].data[D].weight}G[A].data.sort(v)}for(var A=0;A<G.length;A++){null==G[A].weight&&(G[A].weight=1);for(var z=0,D=0;D<G[A].data.length;D++){z+=G[A].data[D].weight}G[A].importance=z*G[A].weight}G.sort(v);for(var j=Number.MAX_VALUE,H=0,A=0;A<G.length;A++){for(var D=0;D<G[A].data.length;D++){for(var a=0;a<G[A].data[D].evolution.length;a++){var w=G[A].data[D].evolution[a].timeScale;j=Math.min(j,w),H=Math.max(H,w)}}}j=~~j,H=~~H;for(var I=function(){var i=H-j+1+~~C;if(0>=i){return[0]}for(var h=[];i--;){h.push(0)}return h}(),q=I.slice(0),n=[],E=0,J=0,A=0;A<G.length;A++){for(var D=0;D<G[A].data.length;D++){var F=G[A].data[D];F.time=[],F.value=[];for(var B,K=0,a=0;a<G[A].data[D].evolution.length;a++){B=G[A].data[D].evolution[a],F.time.push(B.timeScale),F.value.push(B.valueScale),K=Math.max(K,B.valueScale)}g(F,C,j),F.y=b(q,F,function(i,h){return i.ypx[h]}),F._offset=b(I,F,function(){return t}),E=Math.max(E,F.y+K),J=Math.max(J,F._offset),n.push(F)}}d(n,x,E,J)}function d(z,C,x,p){for(var B=C.height,k=p/B>0.5?0.5:1,j=C.y,D=(C.height-p)/x,w=0,y=z.length;y>w;w++){var u=z[w];u.y=j+D*u.y+u._offset*k,delete u.time,delete u.value,delete u.xpx,delete u.ypx,delete u._offset;for(var q=u.evolution,v=0,A=q.length;A>v;v++){q[v].valueScale*=D}}}function c(l,k,j,p){if(l===j){throw new Error("x0 is equal with x1!!!")}if(k===p){return function(){return k}}var h=(k-p)/(l-j),m=(p*l-k*j)/(l-j);return function(a){return h*a+m}}function g(x,z,k){var y=~~z,j=x.time.length;x.xpx=[],x.ypx=[];for(var i,A=0,v=0,w=0,q=0,p=0;j>A;A++){v=~~x.time[A],q=x.value[A]/2,A===j-1?(w=v+y,p=0):(w=~~x.time[A+1],p=x.value[A+1]/2),i=c(v,q,w,p);for(var u=v;w>u;u++){x.xpx.push(u-k),x.ypx.push(i(u))}}x.xpx.push(w-k),x.ypx.push(p)}function b(m,k,j){for(var q,h=0,p=k.xpx.length,l=0;p>l;l++){q=j(k,l),h=Math.max(h,q+m[k.xpx[l]])}for(l=0;p>l;l++){q=j(k,l),m[k.xpx[l]]=h+q}return h}return f});