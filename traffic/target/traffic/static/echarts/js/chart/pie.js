define("echarts/chart/pie",["require","./base","zrender/shape/Text","zrender/shape/Ring","zrender/shape/Circle","zrender/shape/Sector","zrender/shape/Polyline","../config","../util/ecData","zrender/tool/util","zrender/tool/math","zrender/tool/color","../chart"],function(u){function y(i,d,m,c,l){p.call(this,i,d,m,c,l);var h=this;h.shapeHandler.onmouseover=function(F){var J=F.target,E=q.get(J,"seriesIndex"),B=q.get(J,"dataIndex"),I=q.get(J,"special"),A=[J.style.x,J.style.y],K=J.style.startAngle,D=J.style.endAngle,G=((D+K)/2+360)%360,H=J.highlightStyle.color,C=h.getLabel(E,B,I,A,G,H,!0);C&&h.zr.addHoverShape(C);var r=h.getLabelLine(E,B,A,J.style.r0,J.style.r,G,H,!0);r&&h.zr.addHoverShape(r)},this.refresh(c)}var p=u("./base"),g=u("zrender/shape/Text"),x=u("zrender/shape/Ring"),f=u("zrender/shape/Circle"),b=u("zrender/shape/Sector"),z=u("zrender/shape/Polyline"),k=u("../config");k.pie={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockWise:!0,startAngle:90,minAngle:0,selectedOffset:10,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"outer"},labelLine:{show:!0,length:20,lineStyle:{width:1,type:"solid"}}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!1},labelLine:{show:!1,length:20,lineStyle:{width:1,type:"solid"}}}}};var q=u("../util/ecData"),v=u("zrender/tool/util"),w=u("zrender/tool/math"),j=u("zrender/tool/color");return y.prototype={type:k.CHART_TYPE_PIE,_buildShape:function(){var o=this.series,h=this.component.legend;this.selectedMap={},this._selected={};var a,C,m;this._selectedMode=!1;for(var l,A=0,B=o.length;B>A;A++){if(o[A].type===k.CHART_TYPE_PIE){if(o[A]=this.reformOption(o[A]),this.legendHoverLink=o[A].legendHoverLink||this.legendHoverLink,l=o[A].name||"",this.selectedMap[l]=h?h.isSelected(l):!0,!this.selectedMap[l]){continue}a=this.parseCenter(this.zr,o[A].center),C=this.parseRadius(this.zr,o[A].radius),this._selectedMode=this._selectedMode||o[A].selectedMode,this._selected[A]=[],this.deepQuery([o[A],this.option],"calculable")&&(m={zlevel:o[A].zlevel,z:o[A].z,hoverable:!1,style:{x:a[0],y:a[1],r0:C[0]<=10?0:C[0]-10,r:C[1]+10,brushType:"stroke",lineWidth:1,strokeColor:o[A].calculableHolderColor||this.ecTheme.calculableHolderColor||k.calculableHolderColor}},q.pack(m,o[A],A,void 0,-1),this.setCalculable(m),m=C[0]<=10?new f(m):new x(m),this.shapeList.push(m)),this._buildSinglePie(A),this.buildMark(A)}}this.addShapeList()},_buildSinglePie:function(X){for(var H,R=this.series,N=R[X],ab=N.data,M=this.component.legend,J=0,I=0,P=0,S=Number.NEGATIVE_INFINITY,Y=[],Z=0,O=ab.length;O>Z;Z++){H=ab[Z].name,this.selectedMap[H]=M?M.isSelected(H):!0,this.selectedMap[H]&&!isNaN(ab[Z].value)&&(0!==+ab[Z].value?J++:I++,P+=+ab[Z].value,S=Math.max(S,+ab[Z].value))}if(0!==P){for(var K,G,T,A,B,D,W=100,ac=N.clockWise,aa=(N.startAngle.toFixed(2)-0+360)%360,E=N.minAngle||0.01,Q=360-E*J-0.01*I,F=N.roseType,Z=0,O=ab.length;O>Z;Z++){if(H=ab[Z].name,this.selectedMap[H]&&!isNaN(ab[Z].value)){if(G=M?M.getColor(H):this.zr.getColor(Z),W=ab[Z].value/P,K="area"!=F?ac?aa-W*Q-(0!==W?E:0.01):W*Q+aa+(0!==W?E:0.01):ac?aa-360/O:360/O+aa,K=K.toFixed(2)-0,W=(100*W).toFixed(2),T=this.parseCenter(this.zr,N.center),A=this.parseRadius(this.zr,N.radius),B=+A[0],D=+A[1],"radius"===F?D=ab[Z].value/S*(D-B)*0.8+0.2*(D-B)+B:"area"===F&&(D=Math.sqrt(ab[Z].value/S)*(D-B)+B),ac){var C;C=aa,aa=K,K=C}this._buildItem(Y,X,Z,W,ab[Z].selected,T,B,D,aa,K,G),ac||(aa=K)}}this._autoLabelLayout(Y,T,D);for(var Z=0,O=Y.length;O>Z;Z++){this.shapeList.push(Y[Z])}Y=null}},_buildItem:function(I,N,G,C,L,B,h,O,F,J,K){var E=this.series,A=((J+F)/2+360)%360,M=this.getSector(N,G,C,L,B,h,O,F,J,K);q.pack(M,E[N],N,E[N].data[G],G,E[N].data[G].name,C),I.push(M);var H=this.getLabel(N,G,C,B,A,K,!1),D=this.getLabelLine(N,G,B,h,O,A,K,!1);D&&(q.pack(D,E[N],N,E[N].data[G],G,E[N].data[G].name,C),I.push(D)),H&&(q.pack(H,E[N],N,E[N].data[G],G,E[N].data[G].name,C),H._labelLine=D,I.push(H))},getSector:function(N,C,J,G,Q,F,D,H,K,O){var E=this.series,B=E[N],L=B.data[C],c=[L,B],m=this.deepMerge(c,"itemStyle.normal")||{},r=this.deepMerge(c,"itemStyle.emphasis")||{},M=this.getItemStyleColor(m.color,N,C,L)||O,R=this.getItemStyleColor(r.color,N,C,L)||("string"==typeof M?j.lift(M,-0.2):M),P={zlevel:B.zlevel,z:B.z,clickable:this.deepQuery(c,"clickable"),style:{x:Q[0],y:Q[1],r0:F,r:D,startAngle:H,endAngle:K,brushType:"both",color:M,lineWidth:m.borderWidth,strokeColor:m.borderColor,lineJoin:"round"},highlightStyle:{color:R,lineWidth:r.borderWidth,strokeColor:r.borderColor,lineJoin:"round"},_seriesIndex:N,_dataIndex:C};if(G){var A=((P.style.startAngle+P.style.endAngle)/2).toFixed(2)-0;P.style._hasSelected=!0,P.style._x=P.style.x,P.style._y=P.style.y;var I=this.query(B,"selectedOffset");P.style.x+=w.cos(A,!0)*I,P.style.y-=w.sin(A,!0)*I,this._selected[N][C]=!0}else{this._selected[N][C]=!1}return this._selectedMode&&(P.onclick=this.shapeHandler.onclick),this.deepQuery([L,B,this.option],"calculable")&&(this.setCalculable(P),P.draggable=!0),(this._needLabel(B,L,!0)||this._needLabelLine(B,L,!0))&&(P.onmouseover=this.shapeHandler.onmouseover),P=new b(P)},getLabel:function(P,D,L,R,H,F,E){var J=this.series,M=J[P],I=M.data[D];if(this._needLabel(M,I,E)){var G,C,N,c=E?"emphasis":"normal",d=v.merge(v.clone(I.itemStyle)||{},M.itemStyle),n=d[c].label,O=n.textStyle||{},S=R[0],Q=R[1],A=this.parseRadius(this.zr,M.radius),K="middle";n.position=n.position||d.normal.label.position,"center"===n.position?(G=S,C=Q,N="center"):"inner"===n.position||"inside"===n.position?(A=(A[0]+A[1])*(n.distance||0.5),G=Math.round(S+A*w.cos(H,!0)),C=Math.round(Q-A*w.sin(H,!0)),F="#fff",N="center"):(A=A[1]- -d[c].labelLine.length,G=Math.round(S+A*w.cos(H,!0)),C=Math.round(Q-A*w.sin(H,!0)),N=H>=90&&270>=H?"right":"left"),"center"!=n.position&&"inner"!=n.position&&"inside"!=n.position&&(G+="left"===N?20:-20),I.__labelX=G-("left"===N?5:-5),I.__labelY=C;var B=new g({zlevel:M.zlevel,z:M.z+1,hoverable:!1,style:{x:G,y:C,color:O.color||F,text:this.getLabelText(P,D,L,c),textAlign:O.align||N,textBaseline:O.baseline||K,textFont:this.getFont(O)},highlightStyle:{brushType:"fill"}});return B._radius=A,B._labelPosition=n.position||"outer",B._rect=B.getRect(B.style),B._seriesIndex=P,B._dataIndex=D,B}},getLabelText:function(A,h,d,C){var c=this.series,B=c[A],m=B.data[h],l=this.deepQuery([m,B],"itemStyle."+C+".label.formatter");return l?"function"==typeof l?l.call(this.myChart,{seriesIndex:A,seriesName:B.name||"",series:B,dataIndex:h,data:m,name:m.name,value:m.value,percent:d}):"string"==typeof l?(l=l.replace("{a}","{a0}").replace("{b}","{b0}").replace("{c}","{c0}").replace("{d}","{d0}"),l=l.replace("{a0}",B.name).replace("{b0}",m.name).replace("{c0}",m.value).replace("{d0}",d)):void 0:m.name},getLabelLine:function(O,C,K,G,Q,F,D,I){var L=this.series,H=L[O],E=H.data[C];if(this._needLabelLine(H,E,I)){var B=I?"emphasis":"normal",M=v.merge(v.clone(E.itemStyle)||{},H.itemStyle),c=M[B].labelLine,d=c.lineStyle||{},s=K[0],N=K[1],R=Q,P=this.parseRadius(this.zr,H.radius)[1]- -c.length,A=w.cos(F,!0),J=w.sin(F,!0);return new z({zlevel:H.zlevel,z:H.z+1,hoverable:!1,style:{pointList:[[s+R*A,N-R*J],[s+P*A,N-P*J],[E.__labelX,E.__labelY]],strokeColor:d.color||D,lineType:d.type,lineWidth:d.width},_seriesIndex:O,_dataIndex:C})}},_needLabel:function(d,c,a){return this.deepQuery([c,d],"itemStyle."+(a?"emphasis":"normal")+".label.show")},_needLabelLine:function(d,c,a){return this.deepQuery([c,d],"itemStyle."+(a?"emphasis":"normal")+".labelLine.show")},_autoLabelLayout:function(m,h,d){for(var A=[],c=[],s=0,l=m.length;l>s;s++){("outer"===m[s]._labelPosition||"outside"===m[s]._labelPosition)&&(m[s]._rect._y=m[s]._rect.y,m[s]._rect.x<h[0]?A.push(m[s]):c.push(m[s]))}this._layoutCalculate(A,h,d,-1),this._layoutCalculate(c,h,d,1)},_layoutCalculate:function(H,L,F,C){function K(e,d,h){for(var c=e;d>c;c++){if(H[c]._rect.y+=h,H[c].style.y+=h,H[c]._labelLine&&(H[c]._labelLine.style.pointList[1][1]+=h,H[c]._labelLine.style.pointList[2][1]+=h),c>e&&d>c+1&&H[c+1]._rect.y>H[c]._rect.y+H[c]._rect.height){return void B(c,h/2)}}B(d-1,h/2)}function B(c,a){for(var d=c;d>=0&&(H[d]._rect.y-=a,H[d].style.y-=a,H[d]._labelLine&&(H[d]._labelLine.style.pointList[1][1]-=a,H[d]._labelLine.style.pointList[2][1]-=a),!(d>0&&H[d]._rect.y>H[d-1]._rect.y+H[d-1]._rect.height));d--){}}function A(U,Y,S,P,X){for(var O,N,Z,R=S[0],T=S[1],V=X>0?Y?Number.MAX_VALUE:0:Y?Number.MAX_VALUE:0,W=0,Q=U.length;Q>W;W++){N=Math.abs(U[W]._rect.y-T),Z=U[W]._radius-P,O=P+Z>N?Math.sqrt((P+Z+20)*(P+Z+20)-Math.pow(U[W]._rect.y-T,2)):Math.abs(U[W]._rect.x+(X>0?0:U[W]._rect.width)-R),Y&&O>=V&&(O=V-10),!Y&&V>=O&&(O=V+10),U[W]._rect.x=U[W].style.x=R+O*X,U[W]._labelLine&&(U[W]._labelLine.style.pointList[2][0]=R+(O-5)*X,U[W]._labelLine.style.pointList[1][0]=R+(O-20)*X),V=O}}H.sort(function(c,a){return c._rect.y-a._rect.y});for(var M,E=0,G=H.length,I=[],J=[],D=0;G>D;D++){M=H[D]._rect.y-E,0>M&&K(D,G,-M,C),E=H[D]._rect.y+H[D]._rect.height}this.zr.getHeight()-E<0&&B(G-1,E-this.zr.getHeight());for(var D=0;G>D;D++){H[D]._rect.y>=L[1]?J.push(H[D]):I.push(H[D])}A(J,!0,L,F,C),A(I,!1,L,F,C)},reformOption:function(c){var a=v.merge;return c=a(a(c||{},v.clone(this.ecTheme.pie||{})),v.clone(k.pie)),c.itemStyle.normal.label.textStyle=this.getTextStyle(c.itemStyle.normal.label.textStyle),c.itemStyle.emphasis.label.textStyle=this.getTextStyle(c.itemStyle.emphasis.label.textStyle),this.z=c.z,this.zlevel=c.zlevel,c},refresh:function(a){a&&(this.option=a,this.series=a.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(O,D){function K(){E--,0===E&&D&&D()}for(var I=this.series,R={},H=0,F=O.length;F>H;H++){R[O[H][0]]=O[H]}var E=0,L={},P={},Q={},J=this.shapeList;this.shapeList=[];for(var G,C,M,l={},H=0,F=O.length;F>H;H++){G=O[H][0],C=O[H][2],M=O[H][3],I[G]&&I[G].type===k.CHART_TYPE_PIE&&(C?(M||(L[G+"_"+I[G].data.length]="delete"),l[G]=1):M?l[G]=0:(L[G+"_-1"]="delete",l[G]=-1),this._buildSinglePie(G))}for(var A,B,H=0,F=this.shapeList.length;F>H;H++){switch(G=this.shapeList[H]._seriesIndex,A=this.shapeList[H]._dataIndex,B=G+"_"+A,this.shapeList[H].type){case"sector":L[B]=this.shapeList[H];break;case"text":P[B]=this.shapeList[H];break;case"polyline":Q[B]=this.shapeList[H]}}this.shapeList=[];for(var N,H=0,F=J.length;F>H;H++){if(G=J[H]._seriesIndex,R[G]){if(A=J[H]._dataIndex+l[G],B=G+"_"+A,N=L[B],!N){continue}if("sector"===J[H].type){"delete"!=N?(E++,this.zr.animate(J[H].id,"style").when(400,{startAngle:N.style.startAngle,endAngle:N.style.endAngle}).done(K).start()):(E++,this.zr.animate(J[H].id,"style").when(400,l[G]<0?{startAngle:J[H].style.startAngle}:{endAngle:J[H].style.endAngle}).done(K).start())}else{if("text"===J[H].type||"polyline"===J[H].type){if("delete"===N){this.zr.delShape(J[H].id)}else{switch(J[H].type){case"text":E++,N=P[B],this.zr.animate(J[H].id,"style").when(400,{x:N.style.x,y:N.style.y}).done(K).start();break;case"polyline":E++,N=Q[B],this.zr.animate(J[H].id,"style").when(400,{pointList:N.style.pointList}).done(K).start()}}}}}}this.shapeList=J,E||D&&D()},onclick:function(C){var F=this.series;if(this.isClick&&C.target){this.isClick=!1;for(var B,l=C.target,E=l.style,h=q.get(l,"seriesIndex"),c=q.get(l,"dataIndex"),G=0,D=this.shapeList.length;D>G;G++){if(this.shapeList[G].id===l.id){if(h=q.get(l,"seriesIndex"),c=q.get(l,"dataIndex"),E._hasSelected){l.style.x=l.style._x,l.style.y=l.style._y,l.style._hasSelected=!1,this._selected[h][c]=!1}else{var A=((E.startAngle+E.endAngle)/2).toFixed(2)-0;l.style._hasSelected=!0,this._selected[h][c]=!0,l.style._x=l.style.x,l.style._y=l.style.y,B=this.query(F[h],"selectedOffset"),l.style.x+=w.cos(A,!0)*B,l.style.y-=w.sin(A,!0)*B}this.zr.modShape(l.id)}else{this.shapeList[G].style._hasSelected&&"single"===this._selectedMode&&(h=q.get(this.shapeList[G],"seriesIndex"),c=q.get(this.shapeList[G],"dataIndex"),this.shapeList[G].style.x=this.shapeList[G].style._x,this.shapeList[G].style.y=this.shapeList[G].style._y,this.shapeList[G].style._hasSelected=!1,this._selected[h][c]=!1,this.zr.modShape(this.shapeList[G].id))}}this.messageCenter.dispatch(k.EVENT.PIE_SELECTED,C.event,{selected:this._selected,target:q.get(l,"name")},this.myChart),this.zr.refreshNextFrame()}}},v.inherits(y,p),u("../chart").define("pie",y),y});