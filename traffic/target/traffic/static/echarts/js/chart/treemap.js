define("echarts/chart/treemap",["require","./base","zrender/tool/area","zrender/shape/Rectangle","zrender/shape/Text","zrender/shape/Line","../layout/TreeMap","../data/Tree","../config","../util/ecData","zrender/config","zrender/tool/event","zrender/tool/util","zrender/tool/color","../chart"],function(v){function y(l,h,s,d,m){q.call(this,l,h,s,d,m),this.refresh(d);var i=this;i._onclick=function(a){return i.__onclick(a)},i.zr.on(g.EVENT.CLICK,i._onclick)}var q=v("./base"),f=v("zrender/tool/area"),x=v("zrender/shape/Rectangle"),c=v("zrender/shape/Text"),b=v("zrender/shape/Line"),z=v("../layout/TreeMap"),p=v("../data/Tree"),u=v("../config");u.treemap={zlevel:0,z:1,calculable:!1,clickable:!0,center:["50%","50%"],size:["80%","80%"],root:"",itemStyle:{normal:{label:{show:!0,x:5,y:12,textStyle:{align:"left",color:"#000",fontFamily:"Arial",fontSize:13,fontStyle:"normal",fontWeight:"normal"}},breadcrumb:{show:!0,textStyle:{}},borderWidth:1,borderColor:"#ccc",childBorderWidth:1,childBorderColor:"#ccc"},emphasis:{}}};var j=v("../util/ecData"),g=v("zrender/config"),k=(v("zrender/tool/event"),v("zrender/tool/util")),w=v("zrender/tool/color");return y.prototype={type:u.CHART_TYPE_TREEMAP,refresh:function(m){this.clear(),m&&(this.option=m,this.series=this.option.series),this._treesMap={};for(var l=this.series,h=this.component.legend,o=0;o<l.length;o++){if(l[o].type===u.CHART_TYPE_TREEMAP){l[o]=this.reformOption(l[o]);var d=l[o].name||"";if(this.selectedMap[d]=h?h.isSelected(d):!0,!this.selectedMap[d]){continue}this._buildSeries(l[o],o)}}},_buildSeries:function(h,d){var a=p.fromOptionData(h.name,h.data);this._treesMap[d]=a;var l=h.root&&a.getNodeById(h.root)||a.root;this._buildTreemap(l,d)},_buildTreemap:function(S,G){for(var O=this.shapeList,K=0;K<O.length;){var aa=O[K];j.get(aa,"seriesIndex")===G?(this.zr.delShape(O[K]),O.splice(K,1)):K++}for(var J=O.length,H=this.series[G],M=H.itemStyle,P=this.parsePercent(H.size[0],this.zr.getWidth())||400,A=this.parsePercent(H.size[1],this.zr.getHeight())||500,B=this.parseCenter(this.zr,H.center),T=B[0]-0.5*P,I=B[1]-0.5*A,Y=P*A,F=0,D=[],Q=S.children,K=0;K<Q.length;K++){F+=Q[K].data.value}for(var Z=0;Z<Q.length;Z++){D.push(Q[Z].data.value*Y/F)}for(var R=new z({x:T,y:I,width:P,height:A}),N=R.run(D),ab=0;ab<N.length;ab++){var E=Q[ab].data,C=N[ab],s=[E.itemStyle,M],m=this.deepMerge(s);m.normal.color||(m.normal.color=this.zr.getColor(ab)),m.emphasis.color||(m.emphasis.color=m.normal.color),this._buildItem(E,m,C,G,ab),E.children&&this._buildChildrenTreemap(E.children,m,C,G)}this.query(H,"itemStyle.normal.breadcrumb.show")&&this._buildBreadcrumb(S,G,T,I+A);for(var K=J;K<O.length;K++){this.zr.addShape(O[K])}},_buildItem:function(s,l,h,B,d){var A=this.series,m=this.getRectangle(s,l,h);j.pack(m,A[B],B,s,d,s.name),this.shapeList.push(m)},getRectangle:function(B,h,d){var D=h.emphasis,C=h.normal,A=this.getLabel(h,d,B.name,B.value),m=this.option.hoverable,a={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:m,clickable:!0,style:k.merge({x:d.x,y:d.y,width:d.width,height:d.height,brushType:"both",color:C.color,lineWidth:C.borderWidth,strokeColor:C.borderColor},A.style,!0),highlightStyle:k.merge({color:D.color,lineWidth:D.borderWidth,strokeColor:D.borderColor},A.highlightStyle,!0)};return new x(a)},getLabel:function(N,D,K,Q){var H=N.normal.label.textStyle,F=[N.emphasis.label.textStyle,H],E=this.deepMerge(F),J=N.normal.label.formatter,L=this.getLabelText(K,Q,J),I=this.getFont(H),n=f.getTextWidth(L,I),A=f.getTextHeight(L,I),O=this.deepQuery([N.emphasis,N.normal],"label.formatter"),G=this.getLabelText(K,Q,O),P=this.getFont(E),C=f.getTextWidth(L,P),B=f.getTextHeight(L,P);N.normal.label.show?(N.normal.label.x+n>D.width||N.normal.label.y+A>D.height)&&(L=""):L="",N.emphasis.label.show?(E.x+C>D.width||E.y+B>D.height)&&(G=""):G="";var M={style:{textX:D.x+N.normal.label.x,textY:D.y+N.normal.label.y,text:L,textPosition:"specific",textColor:H.color,textFont:I},highlightStyle:{textX:D.x+N.emphasis.label.x,textY:D.y+N.emphasis.label.y,text:G,textColor:E.color,textPosition:"specific"}};return M},getLabelText:function(h,d,a){return a?"function"==typeof a?a.call(this.myChart,h,d):"string"==typeof a?(a=a.replace("{b}","{b0}").replace("{c}","{c0}"),a=a.replace("{b0}",h).replace("{c0}",d)):void 0:h},_buildChildrenTreemap:function(I,O,F,B){for(var M=F.width*F.height,A=0,m=[],E=0;E<I.length;E++){A+=I[E].value}for(var G=0;G<I.length;G++){m.push(I[G].value*M/A)}for(var C=new z({x:F.x,y:F.y,width:F.width,height:F.height}),D=C.run(m),J=O.normal.childBorderWidth,s=O.normal.childBorderColor,K=0;K<D.length;K++){var N=D[K],L=[];F.y.toFixed(2)!==N.y.toFixed(2)&&L.push(this._getLine(N.x,N.y,N.x+N.width,N.y,J,s)),F.x.toFixed(2)!==N.x.toFixed(2)&&L.push(this._getLine(N.x,N.y,N.x,N.y+N.height,J,s)),(F.y+F.height).toFixed(2)!==(N.y+N.height).toFixed(2)&&L.push(this._getLine(N.x,N.y+N.height,N.x+N.width,N.y+N.height,J,s)),(F.x+F.width).toFixed(2)!==(N.x+N.width).toFixed(2)&&L.push(this._getLine(N.x+N.width,N.y,N.x+N.width,N.y+N.height,J,s));for(var H=0;H<L.length;H++){j.set(L[H],"seriesIndex",B),this.shapeList.push(L[H])}}},_getLine:function(r,l,h,B,d,A){var m={zlevel:this.getZlevelBase(),z:this.getZBase(),hoverable:!1,style:{xStart:r,yStart:l,xEnd:h,yEnd:B,lineWidth:d,strokeColor:A}};return new b(m)},_buildBreadcrumb:function(E,I,C,o){for(var G=[],d=E;d;){G.unshift(d.data.name),d=d.parent}for(var J=this.series[I],B=this.query(J,"itemStyle.normal.breadcrumb.textStyle")||{},D=this.query(J,"itemStyle.emphasis.breadcrumb.textStyle")||{},A={y:o+10,textBaseline:"top",textAlign:"left",color:B.color,textFont:this.getFont(B)},m={brushType:"fill",color:D.color||w.lift(B.color,-0.3),textFont:this.getFont(D)},F=0;F<G.length;F++){var H=new c({zlevel:this.getZlevelBase(),z:this.getZBase(),style:k.merge({x:C,text:G[F]+(G.length-1-F?" > ":"")},A),clickable:!0,highlightStyle:m});j.set(H,"seriesIndex",I),j.set(H,"name",G[F]),C+=H.getRect(H.style).width,this.shapeList.push(H)}},__onclick:function(m){var l=m.target;if(l){var h=j.get(l,"seriesIndex"),s=j.get(l,"name"),d=this._treesMap[h],r=d.getNodeById(s);r&&r.children.length&&this._buildTreemap(r,h)}}},k.inherits(y,q),v("../chart").define("treemap",y),y}),define("echarts/layout/TreeMap",["require"],function(){function a(b){({x:b.x,y:b.y,width:b.width,height:b.height});this.x=b.x,this.y=b.y,this.width=b.width,this.height=b.height}return a.prototype.run=function(c){var b=[];return this._squarify(c,{x:this.x,y:this.y,width:this.width,height:this.height},b),b},a.prototype._squarify=function(u,w,p){var d="VERTICAL",v=w.width,c=w.height;w.width<w.height&&(d="HORIZONTAL",v=w.height,c=w.width);for(var b=this._getShapeListInAbstractRow(u,v,c),x=0;x<b.length;x++){b[x].x=0,b[x].y=0;for(var k=0;x>k;k++){b[x].y+=b[k].height}}var q={};if("VERTICAL"==d){for(var g=0;g<b.length;g++){p.push({x:b[g].x+w.x,y:b[g].y+w.y,width:b[g].width,height:b[g].height})}q={x:b[0].width+w.x,y:w.y,width:w.width-b[0].width,height:w.height}}else{for(var f=0;f<b.length;f++){p.push({x:b[f].y+w.x,y:b[f].x+w.y,width:b[f].height,height:b[f].width})}q={x:w.x,y:w.y+b[0].width,width:w.width,height:w.height-b[0].width}}var j=u.slice(b.length);0!==j.length&&this._squarify(j,q,p)},a.prototype._getShapeListInAbstractRow=function(f,d,c){if(1===f.length){return[{width:d,height:c}]}for(var h=1;h<f.length;h++){var b=this._placeFixedNumberRectangles(f.slice(0,h),d,c),g=this._placeFixedNumberRectangles(f.slice(0,h+1),d,c);if(this._isFirstBetter(b,g)){return b}}},a.prototype._placeFixedNumberRectangles=function(k,p,g){for(var d=k.length,m=[],c=0,b=0;b<k.length;b++){c+=k[b]}for(var q=c/g,f=0;d>f;f++){var j=g*k[f]/c;m.push({width:q,height:j})}return m},a.prototype._isFirstBetter=function(d,c){var b=d[0].height/d[0].width;b=b>1?1/b:b;var f=c[0].height/c[0].width;return f=f>1?1/f:f,Math.abs(b-1)<=Math.abs(f-1)?!0:!1},a}),define("echarts/data/Tree",["require","zrender/tool/util"],function(c){function b(g,f){this.id=g,this.depth=0,this.height=0,this.children=[],this.parent=null,this.data=f||null}function a(f){this.root=new b(f)}var d=c("zrender/tool/util");return b.prototype.add=function(g){var f=this.children;g.parent!==this&&(f.push(g),g.parent=this)},b.prototype.remove=function(h){var g=this.children,f=d.indexOf(g,h);f>=0&&(g.splice(f,1),h.parent=null)},b.prototype.traverse=function(h,g){h.call(g,this);for(var f=0;f<this.children.length;f++){this.children[f].traverse(h,g)}},b.prototype.updateDepthAndHeight=function(h){var g=0;this.depth=h;for(var f=0;f<this.children.length;f++){var j=this.children[f];j.updateDepthAndHeight(h+1),j.height>g&&(g=j.height)}this.height=g+1},b.prototype.getNodeById=function(h){if(this.id===h){return this}for(var g=0;g<this.children.length;g++){var f=this.children[g].getNodeById(h);if(f){return f}}},a.prototype.traverse=function(g,f){this.root.traverse(g,f)},a.prototype.getSubTree=function(g){var f=this.getNodeById(g);if(f){var h=new a(f.id);return h.root=f,h}},a.prototype.getNodeById=function(f){return this.root.getNodeById(f)},a.fromOptionData=function(i,k){function f(p,l){var s=new b(p.name,p);l.add(s);var q=p.children;if(q){for(var m=0;m<q.length;m++){f(q[m],s)}}}var j=new a(i),h=j.root;h.data={name:i,children:k};for(var g=0;g<k.length;g++){f(k[g],h)}return j.root.updateDepthAndHeight(0),j},a.fromGraph=function(q){function i(l){for(var h=q.getNodeById(l.id),e=0;e<h.outEdges.length;e++){var n=h.outEdges[e],m=g[n.node2.id];l.children.push(m),i(m)}}for(var t={},g={},f=0;f<q.nodes.length;f++){var u,k=q.nodes[f];0===k.inDegree()?(t[k.id]=new a(k.id),u=t[k.id].root):u=new b(k.id),u.data=k.data,g[k.id]=u}var p=[];for(var j in t){i(t[j].root),t[j].root.updateDepthAndHeight(0),p.push(t[j])}return p},a});