(function(e,d,f){(function(b){typeof define=="function"&&define.amd?define(["jquery"],b):jQuery&&!jQuery.fn.sparkline&&b(jQuery)})(function(ar){var aq={},ap,ao,an,am,al,ak,aj,ai,ah,ag,af,ad,ab,Z,X,V,T,R,P,N,c,ae,ac,aa,Y,W,U,S,Q,O,M,b,a=0;ap=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:f,normalRangeMax:f,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:f,chartRangeMax:f,chartRangeMinX:f,chartRangeMaxX:f,tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:f,nullColor:f,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:f,chartRangeMin:f,chartRangeClip:!1,colorMap:f,tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:f,thresholdValue:0,chartRangeMax:f,chartRangeMin:f,chartRangeClip:!1,tooltipFormat:new an("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:f,tooltipFormat:new an("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new an('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:f,targetColor:"#4a2",chartRangeMax:f,chartRangeMin:f,tooltipFormat:new an("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},W='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',ao=function(){var h,g;return h=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(h.prototype=ar.extend(new arguments[0],arguments[arguments.length-1]),h._super=arguments[0].prototype):h.prototype=arguments[arguments.length-1],arguments.length>2&&(g=Array.prototype.slice.call(arguments,1,-1),g.unshift(h.prototype),ar.extend.apply(ar,g))):h.prototype=arguments[0],h.prototype.cls=h,h},ar.SPFormatClass=an=ao({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(h,g){this.format=h,this.fclass=g},render:function(u,t,s){var r=this,q=u,p,o,n,m,l;return this.format.replace(this.fre,function(){var g;return o=arguments[1],n=arguments[3],p=r.precre.exec(o),p?(l=p[2],o=p[1]):l=!1,m=q[o],m===f?"":n&&t&&t[n]?(g=t[n],g.get?t[n].get(m)||m:t[n][m]||m):(ah(m)&&(s.get("numberFormatter")?m=s.get("numberFormatter")(m):m=Z(m,l,s.get("numberDigitGroupCount"),s.get("numberDigitGroupSep"),s.get("numberDecimalMark"))),m)})}}),ar.spformat=function(h,g){return new an(h,g)},am=function(h,g,i){return h<g?g:h>i?i:h},al=function(g,i){var h;return i===2?(h=d.floor(g.length/2),g.length%2?g[h]:(g[h-1]+g[h])/2):g.length%2?(h=(g.length*i+i)/4,h%1?(g[d.floor(h)]+g[d.floor(h)-1])/2:g[h-1]):(h=(g.length*i+2)/4,h%1?(g[d.floor(h)]+g[d.floor(h)-1])/2:g[h-1])},ak=function(h){var g;switch(h){case"undefined":h=f;break;case"null":h=null;break;case"true":h=!0;break;case"false":h=!1;break;default:g=parseFloat(h),h==g&&(h=g)}return h},aj=function(h){var g,i=[];for(g=h.length;g--;){i[g]=ak(h[g])}return i},ai=function(h,g){var k,j,i=[];for(k=0,j=h.length;k<j;k++){h[k]!==g&&i.push(h[k])}return i},ah=function(g){return !isNaN(parseFloat(g))&&isFinite(g)},Z=function(j,i,o,n,m){var l,k;j=(i===!1?parseFloat(j).toString():j.toFixed(i)).split(""),l=(l=ar.inArray(".",j))<0?j.length:l,l<j.length&&(j[l]=m);for(k=l-o;k>0;k-=o){j.splice(k,0,n)}return j.join("")},ag=function(h,g,j){var i;for(i=g.length;i--;){if(j&&g[i]===null){continue}if(g[i]!==h){return !1}}return !0},af=function(h){var g=0,i;for(i=h.length;i--;){g+=typeof h[i]=="number"?h[i]:0}return g},ab=function(g){return ar.isArray(g)?g:[g]},ad=function(g){var h;e.createStyleSheet?e.createStyleSheet().cssText=g:(h=e.createElement("style"),h.type="text/css",e.getElementsByTagName("head")[0].appendChild(h),h[typeof e.body.style.WebkitAppearance=="string"?"innerText":"innerHTML"]=g)},ar.fn.simpledraw=function(k,q,p,o){var n,m;if(p&&(n=this.data("_jqs_vcanvas"))){return n}if(ar.fn.sparkline.canvas===!1){return !1}if(ar.fn.sparkline.canvas===f){var l=e.createElement("canvas");if(!l.getContext||!l.getContext("2d")){if(!e.namespaces||!!e.namespaces.v){return ar.fn.sparkline.canvas=!1,!1}e.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),ar.fn.sparkline.canvas=function(h,g,j,i){return new M(h,g,j)}}else{ar.fn.sparkline.canvas=function(h,g,j,i){return new O(h,g,j,i)}}}return k===f&&(k=ar(this).innerWidth()),q===f&&(q=ar(this).innerHeight()),n=ar.fn.sparkline.canvas(k,q,this,o),m=ar(this).data("_jqs_mhandler"),m&&m.registerCanvas(n),n},ar.fn.cleardraw=function(){var g=this.data("_jqs_vcanvas");g&&g.reset()},ar.RangeMapClass=X=ao({init:function(h){var g,j,i=[];for(g in h){h.hasOwnProperty(g)&&typeof g=="string"&&g.indexOf(":")>-1&&(j=g.split(":"),j[0]=j[0].length===0?-Infinity:parseFloat(j[0]),j[1]=j[1].length===0?Infinity:parseFloat(j[1]),j[2]=h[g],i.push(j))}this.map=h,this.rangelist=i||!1},get:function(h){var g=this.rangelist,k,j,i;if((i=this.map[h])!==f){return i}if(g){for(k=g.length;k--;){j=g[k];if(j[0]<=h&&j[1]>=h){return j[2]}}}return f}}),ar.range_map=function(g){return new X(g)},V=ao({init:function(h,g){var i=ar(h);this.$el=i,this.options=g,this.currentPageX=0,this.currentPageY=0,this.el=h,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!g.get("disableTooltips"),this.highlightEnabled=!g.get("disableHighlight")},registerSparkline:function(g){this.splist.push(g),this.over&&this.updateDisplay()},registerCanvas:function(h){var g=ar(h.canvas);this.canvas=h,this.$canvas=g,g.mouseenter(ar.proxy(this.mouseenter,this)),g.mouseleave(ar.proxy(this.mouseleave,this)),g.click(ar.proxy(this.mouseclick,this))},reset:function(g){this.splist=[],this.tooltip&&g&&(this.tooltip.remove(),this.tooltip=f)},mouseclick:function(h){var g=ar.Event("sparklineClick");g.originalEvent=h,g.sparklines=this.splist,this.$el.trigger(g)},mouseenter:function(g){ar(e.body).unbind("mousemove.jqs"),ar(e.body).bind("mousemove.jqs",ar.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=g.pageX,this.currentPageY=g.pageY,this.currentEl=g.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new T(this.options),this.tooltip.updatePosition(g.pageX,g.pageY)),this.updateDisplay()},mouseleave:function(){ar(e.body).unbind("mousemove.jqs");var h=this.splist,l=h.length,k=!1,j,i;this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null);for(i=0;i<l;i++){j=h[i],j.clearRegionHighlight()&&(k=!0)}k&&this.canvas.render()},mousemove:function(g){this.currentPageX=g.pageX,this.currentPageY=g.pageY,this.currentEl=g.target,this.tooltip&&this.tooltip.updatePosition(g.pageX,g.pageY),this.updateDisplay()},updateDisplay:function(){var w=this.splist,v=w.length,u=!1,t=this.$canvas.offset(),s=this.currentPageX-t.left,r=this.currentPageY-t.top,q,p,o,n,m;if(!this.over){return}for(o=0;o<v;o++){p=w[o],n=p.setRegionHighlight(this.currentEl,s,r),n&&(u=!0)}if(u){m=ar.Event("sparklineRegionChange"),m.sparklines=this.splist,this.$el.trigger(m);if(this.tooltip){q="";for(o=0;o<v;o++){p=w[o],q+=p.getCurrentRegionTooltip()}this.tooltip.setContent(q)}this.disableHighlight||this.canvas.render()}n===null&&this.mouseleave()}}),T=ao({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(g){var j=g.get("tooltipClassname","jqstooltip"),i=this.sizeStyle,h;this.container=g.get("tooltipContainer")||e.body,this.tooltipOffsetX=g.get("tooltipOffsetX",10),this.tooltipOffsetY=g.get("tooltipOffsetY",12),ar("#jqssizetip").remove(),ar("#jqstooltip").remove(),this.sizetip=ar("<div/>",{id:"jqssizetip",style:i,"class":j}),this.tooltip=ar("<div/>",{id:"jqstooltip","class":j}).appendTo(this.container),h=this.tooltip.offset(),this.offsetLeft=h.left,this.offsetTop=h.top,this.hidden=!0,ar(window).unbind("resize.jqs scroll.jqs"),ar(window).bind("resize.jqs scroll.jqs",ar.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=ar(window).scrollTop(),this.scrollLeft=ar(window).scrollLeft(),this.scrollRight=this.scrollLeft+ar(window).width(),this.updatePosition()},getSize:function(g){this.sizetip.html(g).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(g){if(!g){this.tooltip.css("visibility","hidden"),this.hidden=!0;return}this.getSize(g),this.tooltip.html(g).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(h,g){if(h===f){if(this.mousex===f){return}h=this.mousex-this.offsetLeft,g=this.mousey-this.offsetTop}else{this.mousex=h-=this.offsetLeft,this.mousey=g-=this.offsetTop}if(!this.height||!this.width||this.hidden){return}g-=this.height+this.tooltipOffsetY,h+=this.tooltipOffsetX,g<this.scrollTop&&(g=this.scrollTop),h<this.scrollLeft?h=this.scrollLeft:h+this.width>this.scrollRight&&(h=this.scrollRight-this.width),this.tooltip.css({left:h,top:g})},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=f,ar(window).unbind("resize.jqs scroll.jqs")}}),U=function(){ad(W)},ar(U),b=[],ar.fn.sparkline=function(g,h){return this.each(function(){var m=new ar.fn.sparkline.options(this,h),l=ar(this),k,j;k=function(){var t,s,r,q,p,o,n;if(g==="html"||g===f){n=this.getAttribute(m.get("tagValuesAttribute"));if(n===f||n===null){n=l.html()}t=n.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")}else{t=g}s=m.get("width")==="auto"?t.length*m.get("defaultPixelsPerValue"):m.get("width");if(m.get("height")==="auto"){if(!m.get("composite")||!ar.data(this,"_jqs_vcanvas")){q=e.createElement("span"),q.innerHTML="a",l.html(q),r=ar(q).innerHeight()||ar(q).height(),ar(q).remove(),q=null}}else{r=m.get("height")}m.get("disableInteraction")?p=!1:(p=ar.data(this,"_jqs_mhandler"),p?m.get("composite")||p.reset():(p=new V(this,m),ar.data(this,"_jqs_mhandler",p)));if(m.get("composite")&&!ar.data(this,"_jqs_vcanvas")){ar.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),ar.data(this,"_jqs_errnotify",!0));return}o=new (ar.fn.sparkline[m.get("type")])(this,t,m,s,r),o.render(),p&&p.registerSparkline(o)};if(ar(this).html()&&!m.get("disableHiddenCheck")&&ar(this).is(":hidden")||!ar(this).parents("body").length){if(!m.get("composite")&&ar.data(this,"_jqs_pending")){for(j=b.length;j;j--){b[j-1][0]==this&&b.splice(j-1,1)}}b.push([this,k]),ar.data(this,"_jqs_pending",!0)}else{k.call(this)}})},ar.fn.sparkline.defaults=ap(),ar.sparkline_display_visible=function(){var h,g,j,i=[];for(g=0,j=b.length;g<j;g++){h=b[g][0],ar(h).is(":visible")&&!ar(h).parents().is(":hidden")?(b[g][1].call(h),ar.data(b[g][0],"_jqs_pending",!1),i.push(g)):!ar(h).closest("html").length&&!ar.data(h,"_jqs_pending")&&(ar.data(b[g][0],"_jqs_pending",!1),i.push(g))}for(g=i.length;g;g--){b.splice(i[g-1],1)}},ar.fn.sparkline.options=ao({init:function(j,i){var n,m,l,k;this.userOptions=i=i||{},this.tag=j,this.tagValCache={},m=ar.fn.sparkline.defaults,l=m.common,this.tagOptionsPrefix=i.enableTagOptions&&(i.tagOptionsPrefix||l.tagOptionsPrefix),k=this.getTagSetting("type"),k===aq?n=m[i.type||l.type]:n=m[k],this.mergedOptions=ar.extend({},l,n,i)},getTagSetting:function(j){var i=this.tagOptionsPrefix,n,m,l,k;if(i===!1||i===f){return aq}if(this.tagValCache.hasOwnProperty(j)){n=this.tagValCache.key}else{n=this.tag.getAttribute(i+j);if(n===f||n===null){n=aq}else{if(n.substr(0,1)==="["){n=n.substr(1,n.length-2).split(",");for(m=n.length;m--;){n[m]=ak(n[m].replace(/(^\s*)|(\s*$)/g,""))}}else{if(n.substr(0,1)==="{"){l=n.substr(1,n.length-2).split(","),n={};for(m=l.length;m--;){k=l[m].split(":",2),n[k[0].replace(/(^\s*)|(\s*$)/g,"")]=ak(k[1].replace(/(^\s*)|(\s*$)/g,""))}}else{n=ak(n)}}}this.tagValCache.key=n}return n},get:function(h,g){var j=this.getTagSetting(h),i;return j!==aq?j:(i=this.mergedOptions[h])===f?g:i}}),ar.fn.sparkline._base=ao({disabled:!1,init:function(i,h,l,k,j){this.el=i,this.$el=ar(i),this.values=h,this.options=l,this.width=k,this.height=j,this.currentRegion=f},initTarget:function(){var g=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),g))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(h,g){},setRegionHighlight:function(i,h,m){var l=this.currentRegion,k=!this.options.get("disableHighlight"),j;return h>this.canvasWidth||m>this.canvasHeight||h<0||m<0?null:(j=this.getRegion(i,h,m),l!==j?(l!==f&&k&&this.removeHighlight(),this.currentRegion=j,j!==f&&k&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==f?(this.removeHighlight(),this.currentRegion=f,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(g){},getCurrentRegionTooltip:function(){var H=this.options,G="",F=[],E,D,C,B,A,z,y,x,w,v,u,h,J,I;if(this.currentRegion===f){return""}E=this.getCurrentRegionFields(),u=H.get("tooltipFormatter");if(u){return u(this,H,E)}H.get("tooltipChartTitle")&&(G+='<div class="jqs jqstitle">'+H.get("tooltipChartTitle")+"</div>\n"),D=this.options.get("tooltipFormat");if(!D){return""}ar.isArray(D)||(D=[D]),ar.isArray(E)||(E=[E]),y=this.options.get("tooltipFormatFieldlist"),x=this.options.get("tooltipFormatFieldlistKey");if(y&&x){w=[];for(z=E.length;z--;){v=E[z][x],(I=ar.inArray(v,y))!=-1&&(w[I]=E[z])}E=w}C=D.length,J=E.length;for(z=0;z<C;z++){h=D[z],typeof h=="string"&&(h=new an(h)),B=h.fclass||"jqsfield";for(I=0;I<J;I++){if(!E[I].isNull||!H.get("tooltipSkipNull")){ar.extend(E[I],{prefix:H.get("tooltipPrefix"),suffix:H.get("tooltipSuffix")}),A=h.render(E[I],H.get("tooltipValueLookups"),H),F.push('<div class="'+B+'">'+A+"</div>")}}}return F.length?G+F.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(i,q){var p=q.get("highlightColor"),o=q.get("highlightLighten"),n,m,l,k;if(p){return p}if(o){n=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(i)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(i);if(n){l=[],m=i.length===4?16:1;for(k=0;k<3;k++){l[k]=am(d.round(parseInt(n[k+1],16)*m*o),0,255)}return"rgb("+l.join(",")+")"}}return i}}),R={changeHighlight:function(h){var g=this.currentRegion,k=this.target,j=this.regionShapes[g],i;j&&(i=this.renderRegion(g,h),ar.isArray(i)||ar.isArray(j)?(k.replaceWithShapes(j,i),this.regionShapes[g]=ar.map(i,function(l){return l.id})):(k.replaceWithShape(j,i),this.regionShapes[g]=i.id))},render:function(){var j=this.values,i=this.target,o=this.regionShapes,n,m,l,k;if(!this.cls._super.render.call(this)){return}for(l=j.length;l--;){n=this.renderRegion(l);if(n){if(ar.isArray(n)){m=[];for(k=n.length;k--;){n[k].append(),m.push(n[k].id)}o[l]=m}else{n.append(),o[l]=n.id}}else{o[l]=null}}i.render()}},ar.fn.sparkline.line=P=ao(ar.fn.sparkline._base,{type:"line",init:function(h,g,k,j,i){P._super.init.call(this,h,g,k,j,i),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(h,g,k){var j,i=this.regionMap;for(j=i.length;j--;){if(i[j]!==null&&g>=i[j][0]&&g<=i[j][1]){return i[j][2]}}return f},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.yvalues[g]===null,x:this.xvalues[g],y:this.yvalues[g],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:g}},renderHighlight:function(){var s=this.currentRegion,r=this.target,q=this.vertices[s],p=this.options,o=p.get("spotRadius"),n=p.get("highlightSpotColor"),m=p.get("highlightLineColor"),l,k;if(!q){return}o&&n&&(l=r.drawCircle(q[0],q[1],o,f,n),this.highlightSpotId=l.id,r.insertAfterShape(this.lastShapeId,l)),m&&(k=r.drawLine(q[0],this.canvasTop,q[0],this.canvasTop+this.canvasHeight,m),this.highlightLineId=k.id,r.insertAfterShape(this.lastShapeId,k))},removeHighlight:function(){var g=this.target;this.highlightSpotId&&(g.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(g.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var u=this.values,t=u.length,s=this.xvalues,r=this.yvalues,q=this.yminmax,p,o,n,m,l;for(p=0;p<t;p++){o=u[p],n=typeof u[p]=="string",m=typeof u[p]=="object"&&u[p] instanceof Array,l=n&&u[p].split(":"),n&&l.length===2?(s.push(Number(l[0])),r.push(Number(l[1])),q.push(Number(l[1]))):m?(s.push(o[0]),r.push(o[1]),q.push(o[1])):(s.push(p),u[p]===null||u[p]==="null"?r.push(null):(r.push(Number(o)),q.push(Number(o))))}this.options.get("xvalues")&&(s=this.options.get("xvalues")),this.maxy=this.maxyorg=d.max.apply(d,q),this.miny=this.minyorg=d.min.apply(d,q),this.maxx=d.max.apply(d,s),this.minx=d.min.apply(d,s),this.xvalues=s,this.yvalues=r,this.yminmax=q},processRangeOptions:function(){var h=this.options,g=h.get("normalRangeMin"),i=h.get("normalRangeMax");g!==f&&(g<this.miny&&(this.miny=g),i>this.maxy&&(this.maxy=i)),h.get("chartRangeMin")!==f&&(h.get("chartRangeClip")||h.get("chartRangeMin")<this.miny)&&(this.miny=h.get("chartRangeMin")),h.get("chartRangeMax")!==f&&(h.get("chartRangeClip")||h.get("chartRangeMax")>this.maxy)&&(this.maxy=h.get("chartRangeMax")),h.get("chartRangeMinX")!==f&&(h.get("chartRangeClipX")||h.get("chartRangeMinX")<this.minx)&&(this.minx=h.get("chartRangeMinX")),h.get("chartRangeMaxX")!==f&&(h.get("chartRangeClipX")||h.get("chartRangeMaxX")>this.maxx)&&(this.maxx=h.get("chartRangeMaxX"))},drawNormalRange:function(t,s,r,q,p){var o=this.options.get("normalRangeMin"),n=this.options.get("normalRangeMax"),m=s+d.round(r-r*((n-this.miny)/p)),l=d.round(r*(n-o)/p);this.target.drawRect(t,m,q,l,f,this.options.get("normalRangeColor")).append()},render:function(){var aV=this.options,aU=this.target,aT=this.canvasWidth,aS=this.canvasHeight,aR=this.vertices,aQ=aV.get("spotRadius"),aP=this.regionMap,aO,aN,aM,aL,aK,aJ,aH,aF,aD,aA,ay,aw,at,x,aI,aG,aE,aC,aB,az,ax,av,au,L,t;if(!P._super.render.call(this)){return}this.scanValues(),this.processRangeOptions(),au=this.xvalues,L=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){return}aL=aK=0,aO=this.maxx-this.minx===0?1:this.maxx-this.minx,aN=this.maxy-this.miny===0?1:this.maxy-this.miny,aM=this.yvalues.length-1,aQ&&(aT<aQ*4||aS<aQ*4)&&(aQ=0);if(aQ){ax=aV.get("highlightSpotColor")&&!aV.get("disableInteraction");if(ax||aV.get("minSpotColor")||aV.get("spotColor")&&L[aM]===this.miny){aS-=d.ceil(aQ)}if(ax||aV.get("maxSpotColor")||aV.get("spotColor")&&L[aM]===this.maxy){aS-=d.ceil(aQ),aL+=d.ceil(aQ)}if(ax||(aV.get("minSpotColor")||aV.get("maxSpotColor"))&&(L[0]===this.miny||L[0]===this.maxy)){aK+=d.ceil(aQ),aT-=d.ceil(aQ)}if(ax||aV.get("spotColor")||aV.get("minSpotColor")||aV.get("maxSpotColor")&&(L[aM]===this.miny||L[aM]===this.maxy)){aT-=d.ceil(aQ)}}aS--,aV.get("normalRangeMin")!==f&&!aV.get("drawNormalOnTop")&&this.drawNormalRange(aK,aL,aS,aT,aN),aH=[],aF=[aH],x=aI=null,aG=L.length;for(t=0;t<aG;t++){aD=au[t],ay=au[t+1],aA=L[t],aw=aK+d.round((aD-this.minx)*(aT/aO)),at=t<aG-1?aK+d.round((ay-this.minx)*(aT/aO)):aT,aI=aw+(at-aw)/2,aP[t]=[x||0,aI,t],x=aI,aA===null?t&&(L[t-1]!==null&&(aH=[],aF.push(aH)),aR.push(null)):(aA<this.miny&&(aA=this.miny),aA>this.maxy&&(aA=this.maxy),aH.length||aH.push([aw,aL+aS]),aJ=[aw,aL+d.round(aS-aS*((aA-this.miny)/aN))],aH.push(aJ),aR.push(aJ))}aE=[],aC=[],aB=aF.length;for(t=0;t<aB;t++){aH=aF[t],aH.length&&(aV.get("fillColor")&&(aH.push([aH[aH.length-1][0],aL+aS]),aC.push(aH.slice(0)),aH.pop()),aH.length>2&&(aH[0]=[aH[0][0],aH[1][1]]),aE.push(aH))}aB=aC.length;for(t=0;t<aB;t++){aU.drawShape(aC[t],aV.get("fillColor"),aV.get("fillColor")).append()}aV.get("normalRangeMin")!==f&&aV.get("drawNormalOnTop")&&this.drawNormalRange(aK,aL,aS,aT,aN),aB=aE.length;for(t=0;t<aB;t++){aU.drawShape(aE[t],aV.get("lineColor"),f,aV.get("lineWidth")).append()}if(aQ&&aV.get("valueSpots")){az=aV.get("valueSpots"),az.get===f&&(az=new X(az));for(t=0;t<aG;t++){av=az.get(L[t]),av&&aU.drawCircle(aK+d.round((au[t]-this.minx)*(aT/aO)),aL+d.round(aS-aS*((L[t]-this.miny)/aN)),aQ,f,av).append()}}aQ&&aV.get("spotColor")&&L[aM]!==null&&aU.drawCircle(aK+d.round((au[au.length-1]-this.minx)*(aT/aO)),aL+d.round(aS-aS*((L[aM]-this.miny)/aN)),aQ,f,aV.get("spotColor")).append(),this.maxy!==this.minyorg&&(aQ&&aV.get("minSpotColor")&&(aD=au[ar.inArray(this.minyorg,L)],aU.drawCircle(aK+d.round((aD-this.minx)*(aT/aO)),aL+d.round(aS-aS*((this.minyorg-this.miny)/aN)),aQ,f,aV.get("minSpotColor")).append()),aQ&&aV.get("maxSpotColor")&&(aD=au[ar.inArray(this.maxyorg,L)],aU.drawCircle(aK+d.round((aD-this.minx)*(aT/aO)),aL+d.round(aS-aS*((this.maxyorg-this.miny)/aN)),aQ,f,aV.get("maxSpotColor")).append())),this.lastShapeId=aU.getLastShapeId(),this.canvasTop=aL,aU.render()}}),ar.fn.sparkline.bar=N=ao(ar.fn.sparkline._base,R,{type:"bar",init:function(aX,aW,aV,aU,aT){var aS=parseInt(aV.get("barWidth"),10),aR=parseInt(aV.get("barSpacing"),10),aQ=aV.get("chartRangeMin"),aP=aV.get("chartRangeMax"),aO=aV.get("chartRangeClip"),aN=Infinity,aM=-Infinity,aL,aK,aJ,aI,aH,aG,aF,aE,aD,aC,aB,aA,az,ay,ax,aw,av,au,at,y,t,m,l;N._super.init.call(this,aX,aW,aV,aU,aT);for(aG=0,aF=aW.length;aG<aF;aG++){y=aW[aG],aL=typeof y=="string"&&y.indexOf(":")>-1;if(aL||ar.isArray(y)){ax=!0,aL&&(y=aW[aG]=aj(y.split(":"))),y=ai(y,null),aK=d.min.apply(d,y),aJ=d.max.apply(d,y),aK<aN&&(aN=aK),aJ>aM&&(aM=aJ)}}this.stacked=ax,this.regionShapes={},this.barWidth=aS,this.barSpacing=aR,this.totalBarWidth=aS+aR,this.width=aU=aW.length*aS+(aW.length-1)*aR,this.initTarget(),aO&&(az=aQ===f?-Infinity:aQ,ay=aP===f?Infinity:aP),aH=[],aI=ax?[]:aH;var k=[],i=[];for(aG=0,aF=aW.length;aG<aF;aG++){if(ax){aw=aW[aG],aW[aG]=at=[],k[aG]=0,aI[aG]=i[aG]=0;for(av=0,au=aw.length;av<au;av++){y=at[av]=aO?am(aw[av],az,ay):aw[av],y!==null&&(y>0&&(k[aG]+=y),aN<0&&aM>0?y<0?i[aG]+=d.abs(y):aI[aG]+=y:aI[aG]+=d.abs(y-(y<0?aM:aN)),aH.push(y))}}else{y=aO?am(aW[aG],az,ay):aW[aG],y=aW[aG]=ak(y),y!==null&&aH.push(y)}}this.max=aA=d.max.apply(d,aH),this.min=aB=d.min.apply(d,aH),this.stackMax=aM=ax?d.max.apply(d,k):aA,this.stackMin=aN=ax?d.min.apply(d,aH):aB,aV.get("chartRangeMin")!==f&&(aV.get("chartRangeClip")||aV.get("chartRangeMin")<aB)&&(aB=aV.get("chartRangeMin")),aV.get("chartRangeMax")!==f&&(aV.get("chartRangeClip")||aV.get("chartRangeMax")>aA)&&(aA=aV.get("chartRangeMax")),this.zeroAxis=aD=aV.get("zeroAxis",!0),aB<=0&&aA>=0&&aD?aC=0:aD==0?aC=aB:aB>0?aC=aB:aC=aA,this.xaxisOffset=aC,aE=ax?d.max.apply(d,aI)+d.max.apply(d,i):aA-aB,this.canvasHeightEf=aD&&aB<0?this.canvasHeight-2:this.canvasHeight-1,aB<aC?(m=ax&&aA>=0?aM:aA,t=(m-aC)/aE*this.canvasHeight,t!==d.ceil(t)&&(this.canvasHeightEf-=2,t=d.ceil(t))):t=this.canvasHeight,this.yoffset=t,ar.isArray(aV.get("colorMap"))?(this.colorMapByIndex=aV.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=aV.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===f&&(this.colorMapByValue=new X(this.colorMapByValue))),this.range=aE},getRegion:function(g,j,i){var h=d.floor(j/this.totalBarWidth);return h<0||h>=this.values.length?f:h},getCurrentRegionFields:function(){var h=this.currentRegion,g=ab(this.values[h]),k=[],j,i;for(i=g.length;i--;){j=g[i],k.push({isNull:j===null,value:j,color:this.calcColor(i,j,h),offset:h})}return k},calcColor:function(l,k,r){var q=this.colorMapByIndex,p=this.colorMapByValue,o=this.options,n,m;return this.stacked?n=o.get("stackedBarColor"):n=k<0?o.get("negBarColor"):o.get("barColor"),k===0&&o.get("zeroColor")!==f&&(n=o.get("zeroColor")),p&&(m=p.get(k))?n=m:q&&q.length>r&&(n=q[r]),ar.isArray(n)?n[l%n.length]:n},renderRegion:function(aB,aA){var az=this.values[aB],ay=this.options,ax=this.xaxisOffset,aw=[],av=this.range,au=this.stacked,at=this.target,L=aB*this.totalBarWidth,K=this.canvasHeightEf,J=this.yoffset,I,H,G,F,E,D,C,B,A,o;az=ar.isArray(az)?az:[az],C=az.length,B=az[0],F=ag(null,az),o=ag(ax,az,!0);if(F){return ay.get("nullColor")?(G=aA?ay.get("nullColor"):this.calcHighlightColor(ay.get("nullColor"),ay),I=J>0?J-1:J,at.drawRect(L,I,this.barWidth-1,0,G,G)):f}E=J;for(D=0;D<C;D++){B=az[D];if(au&&B===ax){if(!o||A){continue}A=!0}av>0?H=d.floor(K*(d.abs(B-ax)/av))+1:H=1,B<ax||B===ax&&J===0?(I=E,E+=H):(I=J-H,J-=H),G=this.calcColor(D,B,aB),aA&&(G=this.calcHighlightColor(G,ay)),aw.push(at.drawRect(L,I,this.barWidth-1,H-1,G,G))}return aw.length===1?aw[0]:aw}}),ar.fn.sparkline.tristate=c=ao(ar.fn.sparkline._base,R,{type:"tristate",init:function(k,j,p,o,n){var m=parseInt(p.get("barWidth"),10),l=parseInt(p.get("barSpacing"),10);c._super.init.call(this,k,j,p,o,n),this.regionShapes={},this.barWidth=m,this.barSpacing=l,this.totalBarWidth=m+l,this.values=ar.map(j,Number),this.width=o=j.length*m+(j.length-1)*l,ar.isArray(p.get("colorMap"))?(this.colorMapByIndex=p.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=p.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===f&&(this.colorMapByValue=new X(this.colorMapByValue))),this.initTarget()},getRegion:function(g,i,h){return d.floor(i/this.totalBarWidth)},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],color:this.calcColor(this.values[g],g),offset:g}},calcColor:function(j,i){var p=this.values,o=this.options,n=this.colorMapByIndex,m=this.colorMapByValue,l,k;return m&&(k=m.get(j))?l=k:n&&n.length>i?l=n[i]:p[i]<0?l=o.get("negBarColor"):p[i]>0?l=o.get("posBarColor"):l=o.get("zeroBarColor"),l},renderRegion:function(w,v){var u=this.values,t=this.options,s=this.target,r,q,p,o,n,m;r=s.pixelHeight,p=d.round(r/2),o=w*this.totalBarWidth,u[w]<0?(n=p,q=p-1):u[w]>0?(n=0,q=p-1):(n=p-1,q=2),m=this.calcColor(u[w],w);if(m===null){return}return v&&(m=this.calcHighlightColor(m,t)),s.drawRect(o,n,this.barWidth-1,q-1,m,m)}}),ar.fn.sparkline.discrete=ae=ao(ar.fn.sparkline._base,R,{type:"discrete",init:function(i,m,l,k,j){ae._super.init.call(this,i,m,l,k,j),this.regionShapes={},this.values=m=ar.map(m,Number),this.min=d.min.apply(d,m),this.max=d.max.apply(d,m),this.range=this.max-this.min,this.width=k=l.get("width")==="auto"?m.length*2:this.width,this.interval=d.floor(k/m.length),this.itemWidth=k/m.length,l.get("chartRangeMin")!==f&&(l.get("chartRangeClip")||l.get("chartRangeMin")<this.min)&&(this.min=l.get("chartRangeMin")),l.get("chartRangeMax")!==f&&(l.get("chartRangeClip")||l.get("chartRangeMax")>this.max)&&(this.max=l.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight=l.get("lineHeight")==="auto"?d.round(this.canvasHeight*0.3):l.get("lineHeight"))},getRegion:function(g,i,h){return d.floor(i/this.itemWidth)},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],offset:g}},renderRegion:function(G,F){var E=this.values,D=this.options,C=this.min,B=this.max,A=this.range,z=this.interval,y=this.target,x=this.canvasHeight,w=this.lineHeight,v=x-w,u,t,s,i;return t=am(E[G],C,B),i=G*z,u=d.round(v-v*((t-C)/A)),s=D.get("thresholdColor")&&t<D.get("thresholdValue")?D.get("thresholdColor"):D.get("lineColor"),F&&(s=this.calcHighlightColor(s,D)),y.drawLine(i,u,i,u+w,s)}}),ar.fn.sparkline.bullet=ac=ao(ar.fn.sparkline._base,{type:"bullet",init:function(k,r,q,p,o){var n,m,l;ac._super.init.call(this,k,r,q,p,o),this.values=r=aj(r),l=r.slice(),l[0]=l[0]===null?l[2]:l[0],l[1]=r[1]===null?l[2]:l[1],n=d.min.apply(d,r),m=d.max.apply(d,r),q.get("base")===f?n=n<0?n:0:n=q.get("base"),this.min=n,this.max=m,this.range=m-n,this.shapes={},this.valueShapes={},this.regiondata={},this.width=p=q.get("width")==="auto"?"4.0em":p,this.target=this.$el.simpledraw(p,o,q.get("composite")),r.length||(this.disabled=!0),this.initTarget()},getRegion:function(h,g,j){var i=this.target.getShapeAt(h,g,j);return i!==f&&this.shapes[i]!==f?this.shapes[i]:f},getCurrentRegionFields:function(){var g=this.currentRegion;return{fieldkey:g.substr(0,1),value:this.values[g.substr(1)],region:g}},changeHighlight:function(h){var g=this.currentRegion,j=this.valueShapes[g],i;delete this.shapes[j];switch(g.substr(0,1)){case"r":i=this.renderRange(g.substr(1),h);break;case"p":i=this.renderPerformance(h);break;case"t":i=this.renderTarget(h)}this.valueShapes[g]=i.id,this.shapes[i.id]=g,this.target.replaceWithShape(j,i)},renderRange:function(g,k){var j=this.values[g],i=d.round(this.canvasWidth*((j-this.min)/this.range)),h=this.options.get("rangeColors")[g-2];return k&&(h=this.calcHighlightColor(h,this.options)),this.target.drawRect(0,0,i-1,this.canvasHeight-1,h,h)},renderPerformance:function(g){var j=this.values[1],i=d.round(this.canvasWidth*((j-this.min)/this.range)),h=this.options.get("performanceColor");return g&&(h=this.calcHighlightColor(h,this.options)),this.target.drawRect(0,d.round(this.canvasHeight*0.3),i-1,d.round(this.canvasHeight*0.4)-1,h,h)},renderTarget:function(h){var m=this.values[0],l=d.round(this.canvasWidth*((m-this.min)/this.range)-this.options.get("targetWidth")/2),k=d.round(this.canvasHeight*0.1),j=this.canvasHeight-k*2,i=this.options.get("targetColor");return h&&(i=this.calcHighlightColor(i,this.options)),this.target.drawRect(l,k,this.options.get("targetWidth")-1,j-1,i,i)},render:function(){var h=this.values.length,g=this.target,j,i;if(!ac._super.render.call(this)){return}for(j=2;j<h;j++){i=this.renderRange(j).append(),this.shapes[i.id]="r"+j,this.valueShapes["r"+j]=i.id}this.values[1]!==null&&(i=this.renderPerformance().append(),this.shapes[i.id]="p1",this.valueShapes.p1=i.id),this.values[0]!==null&&(i=this.renderTarget().append(),this.shapes[i.id]="t0",this.valueShapes.t0=i.id),g.render()}}),ar.fn.sparkline.pie=aa=ao(ar.fn.sparkline._base,{type:"pie",init:function(j,p,o,n,m){var l=0,k;aa._super.init.call(this,j,p,o,n,m),this.shapes={},this.valueShapes={},this.values=p=ar.map(p,Number),o.get("width")==="auto"&&(this.width=this.height);if(p.length>0){for(k=p.length;k--;){l+=p[k]}}this.total=l,this.initTarget(),this.radius=d.floor(d.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(h,g,j){var i=this.target.getShapeAt(h,g,j);return i!==f&&this.shapes[i]!==f?this.shapes[i]:f},getCurrentRegionFields:function(){var g=this.currentRegion;return{isNull:this.values[g]===f,value:this.values[g],percent:this.values[g]/this.total*100,color:this.options.get("sliceColors")[g%this.options.get("sliceColors").length],offset:g}},changeHighlight:function(h){var g=this.currentRegion,j=this.renderSlice(g,h),i=this.valueShapes[g];delete this.shapes[i],this.target.replaceWithShape(i,j),this.valueShapes[g]=j.id,this.shapes[j.id]=g},renderSlice:function(H,G){var F=this.target,E=this.options,D=this.radius,C=E.get("borderWidth"),B=E.get("offset"),A=2*d.PI,z=this.values,y=this.total,x=B?2*d.PI*(B/360):0,w,v,u,t,s;t=z.length;for(u=0;u<t;u++){w=x,v=x,y>0&&(v=x+A*(z[u]/y));if(H===u){return s=E.get("sliceColors")[u%E.get("sliceColors").length],G&&(s=this.calcHighlightColor(s,E)),F.drawPieSlice(D,D,D-C,w,v,f,s)}x=v}},render:function(){var j=this.target,p=this.values,o=this.options,n=this.radius,m=o.get("borderWidth"),l,k;if(!aa._super.render.call(this)){return}m&&j.drawCircle(n,n,d.floor(n-m/2),o.get("borderColor"),f,m).append();for(k=p.length;k--;){p[k]&&(l=this.renderSlice(k).append(),this.valueShapes[k]=l.id,this.shapes[l.id]=k)}j.render()}}),ar.fn.sparkline.box=Y=ao(ar.fn.sparkline._base,{type:"box",init:function(h,g,k,j,i){Y._super.init.call(this,h,g,k,j,i),this.values=ar.map(g,Number),this.width=k.get("width")==="auto"?"4.0em":j,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var g=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==f&&g.push({field:"lo",value:this.loutlier}),this.routlier!==f&&g.push({field:"ro",value:this.routlier}),this.lwhisker!==f&&g.push({field:"lw",value:this.lwhisker}),this.rwhisker!==f&&g.push({field:"rw",value:this.rwhisker}),g},render:function(){var aw=this.target,av=this.values,au=av.length,at=this.options,L=this.canvasWidth,K=this.canvasHeight,J=at.get("chartRangeMin")===f?d.min.apply(d,av):at.get("chartRangeMin"),I=at.get("chartRangeMax")===f?d.max.apply(d,av):at.get("chartRangeMax"),H=0,G,F,E,D,C,B,A,z,y,x,j;if(!Y._super.render.call(this)){return}if(at.get("raw")){at.get("showOutliers")&&av.length>5?(F=av[0],G=av[1],D=av[2],C=av[3],B=av[4],A=av[5],z=av[6]):(G=av[0],D=av[1],C=av[2],B=av[3],A=av[4])}else{av.sort(function(h,g){return h-g}),D=al(av,1),C=al(av,2),B=al(av,3),E=B-D;if(at.get("showOutliers")){G=A=f;for(y=0;y<au;y++){G===f&&av[y]>D-E*at.get("outlierIQR")&&(G=av[y]),av[y]<B+E*at.get("outlierIQR")&&(A=av[y])}F=av[0],z=av[au-1]}else{G=av[0],A=av[au-1]}}this.quartiles=[D,C,B],this.lwhisker=G,this.rwhisker=A,this.loutlier=F,this.routlier=z,j=L/(I-J+1),at.get("showOutliers")&&(H=d.ceil(at.get("spotRadius")),L-=2*d.ceil(at.get("spotRadius")),j=L/(I-J+1),F<G&&aw.drawCircle((F-J)*j+H,K/2,at.get("spotRadius"),at.get("outlierLineColor"),at.get("outlierFillColor")).append(),z>A&&aw.drawCircle((z-J)*j+H,K/2,at.get("spotRadius"),at.get("outlierLineColor"),at.get("outlierFillColor")).append()),aw.drawRect(d.round((D-J)*j+H),d.round(K*0.1),d.round((B-D)*j),d.round(K*0.8),at.get("boxLineColor"),at.get("boxFillColor")).append(),aw.drawLine(d.round((G-J)*j+H),d.round(K/2),d.round((D-J)*j+H),d.round(K/2),at.get("lineColor")).append(),aw.drawLine(d.round((G-J)*j+H),d.round(K/4),d.round((G-J)*j+H),d.round(K-K/4),at.get("whiskerColor")).append(),aw.drawLine(d.round((A-J)*j+H),d.round(K/2),d.round((B-J)*j+H),d.round(K/2),at.get("lineColor")).append(),aw.drawLine(d.round((A-J)*j+H),d.round(K/4),d.round((A-J)*j+H),d.round(K-K/4),at.get("whiskerColor")).append(),aw.drawLine(d.round((C-J)*j+H),d.round(K*0.1),d.round((C-J)*j+H),d.round(K*0.9),at.get("medianColor")).append(),at.get("target")&&(x=d.ceil(at.get("spotRadius")),aw.drawLine(d.round((at.get("target")-J)*j+H),d.round(K/2-x),d.round((at.get("target")-J)*j+H),d.round(K/2+x),at.get("targetColor")).append(),aw.drawLine(d.round((at.get("target")-J)*j+H-x),d.round(K/2),d.round((at.get("target")-J)*j+H+x),d.round(K/2),at.get("targetColor")).append()),aw.render()}}),S=ao({init:function(h,g,j,i){this.target=h,this.id=g,this.type=j,this.args=i},append:function(){return this.target.appendShape(this),this}}),Q=ao({_pxregex:/(\d+)(px)?\s*$/i,init:function(h,g,i){if(!h){return}this.width=h,this.height=g,this.target=i,this.lastShapeId=null,i[0]&&(i=i[0]),ar.data(i,"_jqs_vcanvas",this)},drawLine:function(h,g,l,k,j,i){return this.drawShape([[h,g],[l,k]],j,i)},drawShape:function(h,g,j,i){return this._genShape("Shape",[h,g,j,i])},drawCircle:function(h,g,l,k,j,i){return this._genShape("Circle",[h,g,l,k,j,i])},drawPieSlice:function(i,h,n,m,l,k,j){return this._genShape("PieSlice",[i,h,n,m,l,k,j])},drawRect:function(h,g,l,k,j,i){return this._genShape("Rect",[h,g,l,k,j,i])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(h,g){ar(g).html(h)},_calculatePixelDims:function(h,g,j){var i;i=this._pxregex.exec(g),i?this.pixelHeight=i[1]:this.pixelHeight=ar(j).height(),i=this._pxregex.exec(h),i?this.pixelWidth=i[1]:this.pixelWidth=ar(j).width()},_genShape:function(h,g){var i=a++;return g.unshift(i),new S(this,i,h,g)},appendShape:function(g){alert("appendShape not implemented")},replaceWithShape:function(h,g){alert("replaceWithShape not implemented")},insertAfterShape:function(h,g){alert("insertAfterShape not implemented")},removeShapeId:function(g){alert("removeShapeId not implemented")},getShapeAt:function(h,g,i){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),O=ao(Q,{init:function(h,k,j,i){O._super.init.call(this,h,k,j),this.canvas=e.createElement("canvas"),j[0]&&(j=j[0]),ar.data(j,"_jqs_vcanvas",this),ar(this.canvas).css({display:"inline-block",width:h,height:k,verticalAlign:"top"}),this._insert(this.canvas,j),this._calculatePixelDims(h,k,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=i,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=f,ar(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(h,g,j){var i=this.canvas.getContext("2d");return h!==f&&(i.strokeStyle=h),i.lineWidth=j===f?1:j,g!==f&&(i.fillStyle=g),i},reset:function(){var g=this._getContext();g.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=f},_drawShape:function(k,j,q,p,o){var n=this._getContext(q,p,o),m,l;n.beginPath(),n.moveTo(j[0][0]+0.5,j[0][1]+0.5);for(m=1,l=j.length;m<l;m++){n.lineTo(j[m][0]+0.5,j[m][1]+0.5)}q!==f&&n.stroke(),p!==f&&n.fill(),this.targetX!==f&&this.targetY!==f&&n.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=k)},_drawCircle:function(k,r,q,p,o,n,m){var l=this._getContext(o,n,m);l.beginPath(),l.arc(r,q,p,0,2*d.PI,!1),this.targetX!==f&&this.targetY!==f&&l.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=k),o!==f&&l.stroke(),n!==f&&l.fill()},_drawPieSlice:function(s,r,q,p,o,n,m,l){var k=this._getContext(m,l);k.beginPath(),k.moveTo(r,q),k.arc(r,q,p,o,n,!1),k.lineTo(r,q),k.closePath(),m!==f&&k.stroke(),l&&k.fill(),this.targetX!==f&&this.targetY!==f&&k.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=s)},_drawRect:function(i,h,n,m,l,k,j){return this._drawShape(i,[[h,n],[h+m,n],[h+m,n+l],[h,n+l],[h,n]],k,j)},appendShape:function(g){return this.shapes[g.id]=g,this.shapeseq.push(g.id),this.lastShapeId=g.id,g.id},replaceWithShape:function(h,g){var j=this.shapeseq,i;this.shapes[g.id]=g;for(i=j.length;i--;){j[i]==h&&(j[i]=g.id)}delete this.shapes[h]},replaceWithShapes:function(i,h){var n=this.shapeseq,m={},l,k,j;for(k=i.length;k--;){m[i[k]]=!0}for(k=n.length;k--;){l=n[k],m[l]&&(n.splice(k,1),delete this.shapes[l],j=k)}for(k=h.length;k--;){n.splice(j,0,h[k].id),this.shapes[h[k].id]=h[k]}},insertAfterShape:function(h,g){var j=this.shapeseq,i;for(i=j.length;i--;){if(j[i]===h){j.splice(i+1,0,g.id),this.shapes[g.id]=g;return}}},removeShapeId:function(h){var g=this.shapeseq,i;for(i=g.length;i--;){if(g[i]===h){g.splice(i,1);break}}delete this.shapes[h]},getShapeAt:function(h,g,i){return this.targetX=g,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var i=this.shapeseq,h=this.shapes,n=i.length,m=this._getContext(),l,k,j;m.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(j=0;j<n;j++){l=i[j],k=h[l],this["_draw"+k.type].apply(this,k.args)}this.interact||(this.shapes={},this.shapeseq=[])}}),M=ao(Q,{init:function(g,j,i){var h;M._super.init.call(this,g,j,i),i[0]&&(i=i[0]),ar.data(i,"_jqs_vcanvas",this),this.canvas=e.createElement("span"),ar(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:g,height:j,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,i),this._calculatePixelDims(g,j,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,h='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",h),this.group=ar(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(A,z,y,x,w){var v=[],u,t,s,r,q,p,o;for(o=0,p=z.length;o<p;o++){v[o]=""+z[o][0]+","+z[o][1]}return u=v.splice(0,1),w=w===f?1:w,t=y===f?' stroked="false" ':' strokeWeight="'+w+'px" strokeColor="'+y+'" ',s=x===f?' filled="false"':' fillColor="'+x+'" filled="true" ',r=v[0]===v[v.length-1]?"x ":"",q='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+A+'" '+t+s+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+u+" l "+v.join(", ")+" "+r+'e"> </v:shape>',q},_drawCircle:function(u,t,s,r,q,p,o){var n,m,l;return t-=r,s-=r,n=q===f?' stroked="false" ':' strokeWeight="'+o+'px" strokeColor="'+q+'" ',m=p===f?' filled="false"':' fillColor="'+p+'" filled="true" ',l='<v:oval  id="jqsshape'+u+'" '+n+m+' style="position:absolute;top:'+s+"px; left:"+t+"px; width:"+r*2+"px; height:"+r*2+'px"></v:oval>',l},_drawPieSlice:function(H,G,F,E,D,C,B,A){var z,y,x,w,v,u,t,s;if(D===C){return""}C-D===2*d.PI&&(D=0,C=2*d.PI),y=G+d.round(d.cos(D)*E),x=F+d.round(d.sin(D)*E),w=G+d.round(d.cos(C)*E),v=F+d.round(d.sin(C)*E);if(y===w&&x===v){if(C-D<d.PI){return""}y=w=G+E,x=v=F}return y===w&&x===v&&C-D<d.PI?"":(z=[G-E,F-E,G+E,F+E,y,x,w,v],u=B===f?' stroked="false" ':' strokeWeight="1px" strokeColor="'+B+'" ',t=A===f?' filled="false"':' fillColor="'+A+'" filled="true" ',s='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+H+'" '+u+t+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+G+","+F+" wa "+z.join(", ")+' x e"> </v:shape>',s)},_drawRect:function(i,h,n,m,l,k,j){return this._drawShape(i,[[h,n],[h,n+l],[h+m,n+l],[h+m,n],[h,n]],k,j)},reset:function(){this.group.innerHTML=""},appendShape:function(h){var g=this["_draw"+h.type].apply(this,h.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",g):this.prerender+=g,this.lastShapeId=h.id,h.id},replaceWithShape:function(h,g){var j=ar("#jqsshape"+h),i=this["_draw"+g.type].apply(this,g.args);j[0].outerHTML=i},replaceWithShapes:function(i,h){var m=ar("#jqsshape"+i[0]),l="",k=h.length,j;for(j=0;j<k;j++){l+=this["_draw"+h[j].type].apply(this,h[j].args)}m[0].outerHTML=l;for(j=1;j<i.length;j++){ar("#jqsshape"+i[j]).remove()}},insertAfterShape:function(h,g){var j=ar("#jqsshape"+h),i=this["_draw"+g.type].apply(this,g.args);j[0].insertAdjacentHTML("afterEnd",i)},removeShapeId:function(h){var g=ar("#jqsshape"+h);this.group.removeChild(g[0])},getShapeAt:function(h,g,j){var i=h.id.substr(8);return i},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})})(document,Math);