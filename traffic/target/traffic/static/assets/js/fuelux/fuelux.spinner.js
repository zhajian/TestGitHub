(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(c,d){var b=c.fn.spinbox;var a=function(f,e){this.$element=c(f);this.options=c.extend({},c.fn.spinbox.defaults,e);this.$input=this.$element.find(".spinbox-input");this.$element.on("focusin.fu.spinbox",this.$input,c.proxy(this.changeFlag,this));this.$element.on("focusout.fu.spinbox",this.$input,c.proxy(this.change,this));this.$element.on("keydown.fu.spinbox",this.$input,c.proxy(this.keydown,this));this.$element.on("keyup.fu.spinbox",this.$input,c.proxy(this.keyup,this));this.bindMousewheelListeners();this.mousewheelTimeout={};if(this.options.hold){this.$element.on("mousedown.fu.spinbox",".spinbox-up",c.proxy(function(){this.startSpin(true)},this));this.$element.on("mouseup.fu.spinbox",".spinbox-up, .spinbox-down",c.proxy(this.stopSpin,this));this.$element.on("mouseout.fu.spinbox",".spinbox-up, .spinbox-down",c.proxy(this.stopSpin,this));this.$element.on("mousedown.fu.spinbox",".spinbox-down",c.proxy(function(){this.startSpin(false)},this))}else{this.$element.on("click.fu.spinbox",".spinbox-up",c.proxy(function(){this.step(true)},this));this.$element.on("click.fu.spinbox",".spinbox-down",c.proxy(function(){this.step(false)},this))}this.switches={count:1,enabled:true};if(this.options.speed==="medium"){this.switches.speed=300}else{if(this.options.speed==="fast"){this.switches.speed=100}else{this.switches.speed=500}}this.lastValue=this.options.value;this.render();if(this.options.disabled){this.disable()}};a.prototype={constructor:a,destroy:function(){this.$element.remove();this.$element.find("input").each(function(){c(this).attr("value",c(this).val())});return this.$element[0].outerHTML},render:function(){var e=this.parseInput(this.$input.val());var f="";if(e!==""&&this.options.value===0){this.value(e)}else{this.output(this.options.value)}if(this.options.units.length){c.each(this.options.units,function(g,h){if(h.length>f.length){f=h}})}},output:function(f,e){f=(f+"").split(".").join(this.options.decimalMark);e=(e||true);if(e){this.$input.val(f)}return f},parseInput:function(e){e=(e+"").split(this.options.decimalMark).join(".");return e},change:function(){var e=this.parseInput(this.$input.val())||"";if(this.options.units.length||this.options.decimalMark!=="."){e=this.parseValueWithUnit(e)}else{if(e/1){e=this.options.value=this.checkMaxMin(e/1)}else{e=this.checkMaxMin(e.replace(/[^0-9.-]/g,"")||"");this.options.value=e/1}}this.output(e);this.changeFlag=false;this.triggerChangedEvent()},changeFlag:function(){this.changeFlag=true},stopSpin:function(){if(this.switches.timeout!==d){clearTimeout(this.switches.timeout);this.switches.count=1;this.triggerChangedEvent()}},triggerChangedEvent:function(){var e=this.value();if(e===this.lastValue){return}this.lastValue=e;this.$element.trigger("changed.fu.spinbox",this.output(e,false))},startSpin:function(e){if(!this.options.disabled){var f=this.switches.count;if(f===1){this.step(e);f=1}else{if(f<3){f=1.5}else{if(f<8){f=2.5}else{f=4}}}this.switches.timeout=setTimeout(c.proxy(function(){this.iterate(e)},this),this.switches.speed/f);this.switches.count++}},iterate:function(e){this.step(e);this.startSpin(e)},step:function(h){var k,e,g,j;if(this.changeFlag){this.change()}g=this.options.value;j=h?this.options.max:this.options.min;if((h?g<j:g>j)){var f=g+(h?1:-1)*this.options.step;if(this.options.step%1!==0){k=(this.options.step+"").split(".")[1].length;e=Math.pow(10,k);f=Math.round(f*e)/e}if(h?f>j:f<j){this.value(j)}else{this.value(f)}}else{if(this.options.cycle){var i=h?this.options.min:this.options.max;this.value(i)}}},value:function(e){if(e||e===0){if(this.options.units.length||this.options.decimalMark!=="."){this.output(this.parseValueWithUnit(e+(this.unit||"")));return this}else{if(!isNaN(parseFloat(e))&&isFinite(e)){this.options.value=e/1;this.output(e+(this.unit?this.unit:""));return this}}}else{if(this.changeFlag){this.change()}if(this.unit){return this.options.value+this.unit}else{return this.output(this.options.value,false)}}},isUnitLegal:function(e){var f;c.each(this.options.units,function(g,h){if(h.toLowerCase()===e.toLowerCase()){f=e.toLowerCase();return false}});return f},parseValueWithUnit:function(g){var f=g.replace(/[^a-zA-Z]/g,"");var e=g.replace(/[^0-9.-]/g,"");if(f){f=this.isUnitLegal(f)}this.options.value=this.checkMaxMin(e/1);this.unit=f||d;return this.options.value+(f||"")},checkMaxMin:function(e){if(isNaN(parseFloat(e))){return e}if(!(e<=this.options.max&&e>=this.options.min)){e=e>=this.options.max?this.options.max:this.options.min}return e},disable:function(){this.options.disabled=true;this.$element.addClass("disabled");this.$input.attr("disabled","");this.$element.find("button").addClass("disabled")},enable:function(){this.options.disabled=false;this.$element.removeClass("disabled");this.$input.removeAttr("disabled");this.$element.find("button").removeClass("disabled")},keydown:function(e){var f=e.keyCode;if(f===38){this.step(true)}else{if(f===40){this.step(false)}}},keyup:function(e){var f=e.keyCode;if(f===38||f===40){this.triggerChangedEvent()}},bindMousewheelListeners:function(){var e=this.$input.get(0);if(e.addEventListener){e.addEventListener("mousewheel",c.proxy(this.mousewheelHandler,this),false);e.addEventListener("DOMMouseScroll",c.proxy(this.mousewheelHandler,this),false)}else{e.attachEvent("onmousewheel",c.proxy(this.mousewheelHandler,this))}},mousewheelHandler:function(g){var h=window.event||g;var i=Math.max(-1,Math.min(1,(h.wheelDelta||-h.detail)));var f=this;clearTimeout(this.mousewheelTimeout);this.mousewheelTimeout=setTimeout(function(){f.triggerChangedEvent()},300);if(i>0){this.step(true)}else{this.step(false)}if(h.preventDefault){h.preventDefault()}else{h.returnValue=false}return false}};c.fn.spinbox=function(g){var f=Array.prototype.slice.call(arguments,1);var h;var e=this.each(function(){var k=c(this);var j=k.data("fu.spinbox");var i=typeof g==="object"&&g;if(!j){k.data("fu.spinbox",(j=new a(this,i)))}if(typeof g==="string"){h=j[g].apply(j,f)}});return(h===d)?e:h};c.fn.spinbox.defaults={value:0,min:0,max:999,step:1,hold:true,speed:"medium",disabled:false,cycle:false,units:[],decimalMark:"."};c.fn.spinbox.Constructor=a;c.fn.spinbox.noConflict=function(){c.fn.spinbox=b;return this};c(document).on("mousedown.fu.spinbox.data-api","[data-initialize=spinbox]",function(g){var f=c(g.target).closest(".spinbox");if(!f.data("fu.spinbox")){f.spinbox(f.data())}});c(function(){c("[data-initialize=spinbox]").each(function(){var e=c(this);if(!e.data("fu.spinbox")){e.spinbox(e.data())}})})}));