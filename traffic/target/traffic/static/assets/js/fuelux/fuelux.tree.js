(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(b){var a=b.fn.tree;var c=function(e,d){this.$element=b(e);this.options=b.extend({},b.fn.tree.defaults,d);this.$element.on("click.fu.tree",".tree-item",b.proxy(function(f){this.selectItem(f.currentTarget)},this));this.$element.on("click.fu.tree",".tree-branch-header",b.proxy(function(f){this.openFolder(f.currentTarget)},this));this.render()};c.prototype={constructor:c,destroy:function(){this.$element.find("li:not([data-template])").remove();this.$element.remove();return this.$element[0].outerHTML},render:function(){this.populate(this.$element)},populate:function(f){var e=this;var h=(f.hasClass("tree"))?f:f.parent();var d=h.find(".tree-loader:eq(0)");var g=h.data();d.removeClass("hide");this.options.dataSource(g?g:{},function(i){d.addClass("hide");b.each(i.data,function(k,m){var l;if(m.type==="folder"){l=e.$element.find("[data-template=treebranch]:eq(0)").clone().removeClass("hide").removeAttr("data-template");l.data(m);l.find(".tree-branch-name > .tree-label").html(m.text||m.name);var n=l.find(".tree-branch-header");if("icon-class" in m){n.find("i").addClass(m["icon-class"])}if("additionalParameters" in m&&"item-selected" in m.additionalParameters&&m.additionalParameters["item-selected"]==true){setTimeout(function(){n.trigger("click")},0)}}else{if(m.type==="item"){l=e.$element.find("[data-template=treeitem]:eq(0)").clone().removeClass("hide").removeAttr("data-template");l.find(".tree-item-name > .tree-label").html(m.text||m.name);l.data(m);if("additionalParameters" in m&&"item-selected" in m.additionalParameters&&m.additionalParameters["item-selected"]==true){l.addClass("tree-selected");l.find("i").removeClass(e.options["unselected-icon"]).addClass(e.options["selected-icon"])}}}var j=m.attr||m.dataAttributes||[];b.each(j,function(o,p){switch(o){case"cssClass":case"class":case"className":l.addClass(p);break;case"data-icon":l.find(".icon-item").removeClass().addClass("icon-item "+p);l.attr(o,p);break;case"id":l.attr(o,p);l.attr("aria-labelledby",p+"-label");l.find(".tree-branch-name > .tree-label").attr("id",p+"-label");break;default:l.attr(o,p);break}});if(f.hasClass("tree-branch-header")){h.find(".tree-branch-children:eq(0)").append(l)}else{f.append(l)}});e.$element.trigger("loaded.fu.tree",h)})},selectItem:function(g){if(this.options.selectable==false){return}var f=b(g);var j=f.data();var i=this.$element.find(".tree-selected");var h=[];var d=f.find(".icon-item");if(this.options.multiSelect){b.each(i,function(l,m){var k=b(m);if(k[0]!==f[0]){h.push(b(m).data())}})}else{if(i[0]!==f[0]){i.removeClass("tree-selected").find("i").removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"]);h.push(j)}}var e="selected";if(f.hasClass("tree-selected")){e="deselected";f.removeClass("tree-selected");if(d.hasClass(this.options["selected-icon"])||d.hasClass(this.options["unselected-icon"])){d.removeClass(this.options["selected-icon"]).addClass(this.options["unselected-icon"])}}else{f.addClass("tree-selected");if(d.hasClass(this.options["selected-icon"])||d.hasClass(this.options["unselected-icon"])){d.removeClass(this.options["unselected-icon"]).addClass(this.options["selected-icon"])}if(this.options.multiSelect){h.push(j)}}this.$element.trigger(e+".fu.tree",{target:j,selected:h});f.trigger("updated.fu.tree",{selected:h,item:f,eventType:e})},openFolder:function(h){var f=b(h);var j;var d;var i;j=f.closest(".tree-branch");d=j.find(".tree-branch-children");i=d.eq(0);var e,k,g;if(f.find("."+b.trim(this.options["close-icon"].replace(/(\s+)/g,"."))).length){e="opened";k=this.options["close-icon"];g=this.options["open-icon"];j.addClass("tree-open");j.attr("aria-expanded","true");i.removeClass("hide");if(!d.children().length){this.populate(d)}}else{if(f.find("."+b.trim(this.options["open-icon"].replace(/(\s+)/g,".")))){e="closed";k=this.options["open-icon"];g=this.options["close-icon"];j.removeClass("tree-open");j.attr("aria-expanded","false");i.addClass("hide");if(!this.options.cacheItems){i.empty()}}}j.find("> .tree-branch-header .icon-folder").eq(0).removeClass(k).addClass(g);this.$element.trigger(e+".fu.tree",j.data())},selectFolder:function(g){var j=b(g);var f=j.closest(".tree-branch");var h=this.$element.find(".tree-branch.tree-selected");var e=f.data();var i=[];var d="selected";if(f.hasClass("tree-selected")){d="deselected";f.removeClass("tree-selected")}else{f.addClass("tree-selected")}if(this.options.multiSelect){h=this.$element.find(".tree-branch.tree-selected");b.each(h,function(k,m){var l=b(m);if(l[0]!==j[0]){i.push(b(m).data())}})}else{if(h[0]!==j[0]){h.removeClass("tree-selected");i.push(e)}}this.$element.trigger(d+".fu.tree",{target:e,selected:i});j.trigger("updated.fu.tree",{selected:i,item:j,eventType:d})},selectedItems:function(){var e=this.$element.find(".tree-selected");var d=[];b.each(e,function(f,g){d.push(b(g).data())});return d},collapse:function(){var d=this.options.cacheItems;this.$element.find("."+b.trim(this.options["open-icon"].replace(/(\s+)/g,"."))).each(function(){var f=b(this).removeClass(this.options["open-icon"]+" "+this.options["close-icon"]).addClass(this.options["close-icon"]);var e=f.parent().parent();var g=e.children(".tree-branch-children");g.addClass("hide");if(!d){g.empty()}})}};b.fn.tree=function(f){var e=Array.prototype.slice.call(arguments,1);var g;var d=this.each(function(){var j=b(this);var i=j.data("fu.tree");var h=typeof f==="object"&&f;if(!i){j.data("fu.tree",(i=new c(this,h)))}if(typeof f==="string"){g=i[f].apply(i,e)}});return(g===undefined)?d:g};b.fn.tree.defaults={dataSource:function(d,e){},multiSelect:false,cacheItems:true,folderSelect:false};b.fn.tree.Constructor=c;b.fn.tree.noConflict=function(){b.fn.tree=a;return this}}));