(function(a){a.fn.ligerListBox=function(b){return a.ligerui.run.call(this,"ligerListBox",arguments)};a.ligerDefaults.ListBox={isMultiSelect:false,isShowCheckBox:false,columns:null,width:150,height:100,onSelect:false,onSelected:null,valueField:"id",textField:"text",valueFieldID:null,split:";",data:null,parms:null,url:null,onSuccess:null,onError:null,render:null,css:null,value:null,valueFieldCssClass:null};a.ligerMethos.ListBox=a.ligerMethos.ListBox||{};a.ligerui.controls.ListBox=function(c,b){a.ligerui.controls.ListBox.base.constructor.call(this,c,b)};a.ligerui.controls.ListBox.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"ListBox"},_extendMethods:function(){return a.ligerMethos.ListBox},_init:function(){a.ligerui.controls.ListBox.base._init.call(this)},_render:function(){var b=this,c=this.options;b.data=c.data;b.valueField=null;if(c.valueFieldID){b.valueField=a("#"+c.valueFieldID+":input,[name="+c.valueFieldID+"]:input");if(b.valueField.length==0){b.valueField=a('<input type="hidden"/>')}b.valueField[0].id=b.valueField[0].name=c.valueFieldID}else{b.valueField=a('<input type="hidden"/>');b.valueField[0].id=b.valueField[0].name=b.id+"_val"}if(b.valueField[0].name==null){b.valueField[0].name=b.valueField[0].id}if(c.valueFieldCssClass){b.valueField.addClass(c.valueFieldCssClass)}b.valueField.attr("data-ligerid",b.id);b.selectBox=a(this.element);b.selectBox.html('<div class="l-listbox-inner"><table cellpadding="0" cellspacing="0" border="0" class="l-listbox-table"></table></div>').addClass("l-listbox").append(b.valueField);b.selectBox.table=a("table:first",b.selectBox);b.set(c);b._addClickEven()},destroy:function(){if(this.selectBox){this.selectBox.remove()}this.options=null;a.ligerui.remove(this)},clear:function(){this._changeValue("");this.trigger("clear")},_setIsShowCheckBox:function(b){if(b){a("table",this.selectBox).addClass("l-table-checkbox")}else{a("table",this.selectBox).addClass("l-table-nocheckbox")}},_setCss:function(b){if(b){this.selectBox.addClass(b)}},_setDisabled:function(b){if(b){this.selectBox.addClass("l-text-disabled")}else{this.selectBox.removeClass("l-text-disabled")}},_setWidth:function(b){this.selectBox.width(b)},_setHeight:function(b){this.selectBox.height(b)},findTextByValue:function(e){var b=this,f=this.options;if(e==null){return""}var d="";var c=function(j){var g=e.toString().split(f.split);for(var h=0;h<g.length;h++){if(g[h]==j){return true}}return false};a(b.data).each(function(h,j){var k=j[f.valueField];var g=j[f.textField];if(c(k)){d+=g+f.split}});if(d.length>0){d=d.substr(0,d.length-1)}return d},getDataByValue:function(e){var d=this,f=this.options;for(var c=0,b=d.data.length;c<b;c++){if(d.data[c][f.valueField]==e){return d.data[c]}}return null},indexOf:function(f){var e=this,h=this.options;if(!e.data){return -1}var c=typeof(f)=="object";for(var d=0,b=e.data.length;d<b;d++){if(c){if(e.data[d]==f){return d}}else{if(e.data[d][h.valueField]&&e.data[d][h.valueField].toString()==f.toString()){return d}}}return -1},removeItems:function(b){var c=this;if(!c.data){return}a(b).each(function(e,f){var d=c.indexOf(f);if(d==-1){return}c.data.splice(d,1)});c.refresh()},removeItem:function(c){if(!this.data){return}var b=this.indexOf(c);if(b==-1){return}this.data.splice(b,1);this.refresh()},insertItem:function(d,b){var c=this;if(!c.data){c.data=[]}c.data.splice(b,0,d);c.refresh()},addItems:function(b){var c=this;if(!c.data){c.data=[]}a(b).each(function(d,e){c.data.push(e)});c.refresh()},addItem:function(c){var b=this;if(!b.data){b.data=[]}b.data.push(c);b.refresh()},getSelectedItems:function(){var c=this,e=this.options;if(!c.data){return null}var d=c.getValue();if(!d){return null}var b=[];a(d.split(e.split)).each(function(){var f=c.indexOf(this.toString());if(f!=-1){b.push(c.data[f])}});return b},_setValue:function(c){var b=this,d=this.options;d.value=c;this._dataInit()},setValue:function(b){this._setValue(b)},_setUrl:function(b){if(!b){return}var c=this,d=this.options;a.ajax({type:"post",url:b,data:d.parms,cache:false,dataType:"json",success:function(e){c.setData(e);c.trigger("success",[e])},error:function(e,f){c.trigger("error",[e,f])}})},setUrl:function(b){return this._setUrl(b)},setParm:function(b,e){if(!b){return}var d=this;var c=d.get("parms");if(!c){c={}}c[b]=e;d.set("parms",c)},clearContent:function(){var b=this,c=this.options;a("table",b.selectBox).html("")},_setColumns:function(b){var c=this,d=this.options;d.columns=b;c.refresh()},_setData:function(b){this.setData(b)},setData:function(c){var b=this,d=this.options;if(!c||!c.length){return}b.data=c;b.refresh();b.updateStyle()},refresh:function(){var n=this,b=this.options,l=this.data;this.clearContent();if(!l){return}if(b.columns){n.selectBox.table.headrow=a("<tr class='l-table-headerow'><td width='18px' class='l-checkboxrow'></td></tr>");n.selectBox.table.append(n.selectBox.table.headrow);n.selectBox.table.addClass("l-listbox-grid");for(var e=0;e<b.columns.length;e++){var q=a("<td columnindex='"+e+"' columnname='"+b.columns[e].name+"'>"+b.columns[e].header+"</td>");if(b.columns[e].width){q.width(b.columns[e].width)}n.selectBox.table.headrow.append(q)}}var f=[];for(var m=0;m<l.length;m++){var c=l[m][b.valueField];var k=l[m][b.textField];var h=" value='"+c+"' index='"+m+"'";if(!b.columns){f.push("<tr "+h+">");f.push("<td style='width:18px;' class='l-checkboxrow'><input type='checkbox'"+h+"/></td>");var d=k;if(b.render){d=b.render({data:l[m],value:c,text:k})}f.push("<td align='left'>"+d+"</td></tr>")}else{f.push("<tr "+h+"><td style='width:18px;' class='l-checkboxrow'><input type='checkbox' "+h+"/></td>");for(var e=0;e<b.columns.length;e++){var o=b.columns[e].name;f.push("<td>"+l[m][o]+"</td>")}f.push("</tr>")}}n.selectBox.table.append(f.join(""))},_getValue:function(){return a(this.valueField).val()},getValue:function(){return this._getValue()},updateStyle:function(){this._dataInit()},selectAll:function(){var c=this,d=this.options;var b=[];a("tr",c.selectBox).each(function(){var e=a(this);b.push(e.attr("value"))});a("tr",c.selectBox).addClass("l-selected").find(":checkbox").each(function(){this.checked=true});c.valueField.val(b.join(d.split))},_dataInit:function(){var c=this,e=this.options;var d=e.value;if(d!=null){c._changeValue(d)}else{if(c.valueField.val()!=""){e.value=c.valueField.val()}}var b=(d||"").toString().split(e.split);a("tr.l-selected",c.selectBox).removeClass("l-selected").find(":checkbox").each(function(){this.checked=false});a(b).each(function(f,g){a("tr[value='"+g+"']",c.selectBox).addClass("l-selected").find(":checkbox").each(function(){this.checked=true})})},_changeValue:function(d){var b=this,c=this.options;b.valueField.val(d);b.selectedValue=d},_updateValue:function(){var c=this,d=this.options;var b=[];a("tr",c.selectBox).each(function(){var e=a(this);if(e.hasClass("l-selected")){b.push(e.attr("value"))}});c._changeValue(b.join(d.split))},_addClickEven:function(){var b=this,c=this.options;b.selectBox.click(function(h){var g=(h.target||h.srcElement);var j=a(g).parents("tr:first");if(!j.length){return}var f=j.attr("value");var i=b.findTextByValue(f),d=b.getDataByValue(f);if(b.hasBind("select")){if(b.trigger("select",[f,i,d])==false){return false}}if(!c.isMultiSelect){a("tr.l-selected",b.selectBox).not(j).removeClass("l-selected").find(":checkbox").each(function(){this.checked=false})}if(j.hasClass("l-selected")){j.removeClass("l-selected")}else{j.addClass("l-selected")}j.find(":checkbox").each(function(){this.checked=j.hasClass("l-selected")});b._updateValue();b.trigger("selected",[f,i,d])})}})})(jQuery);